/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var t={171:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(601),s=n.n(r),i=n(314),o=n.n(i)()(s());o.push([t.id,"* {\n    margin: 5px;\n    font-family: Arial, Helvetica, sans-serif;\n}\n\nimg {\n    width: 275px;\n    height: 250px;\n    border-radius: 10px;\n}\n",""]);const a=o},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",r=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),r&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),r&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,r,s,i){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var h=0;h<t.length;h++){var u=[].concat(t[h]);r&&o[u[0]]||(void 0!==i&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),s&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=s):u[4]="".concat(s)),e.push(u))}},e}},601:t=>{t.exports=function(t){return t[1]}}},e={};function n(r){var s=e[r];if(void 0!==s)return s.exports;var i=e[r]={id:r,exports:{}};return t[r](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{let t={screen:"POST"},e=[];const r=n=>{const r=JSON.parse(JSON.stringify(t));t=((t,e)=>{const{action:n,payload:r}=t;return"changeScreen"===n&&(e.screen=r),e})(n,r),e.forEach((t=>t.render()))},s=t=>{e=[...e,t]},i=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++r)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},o={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const s=t[e],i=e+1<t.length,o=i?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,h=s>>2,u=(3&s)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(l=64)),r.push(n[h],n[u],n[l],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(i(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],i=e<t.length?n[t.charAt(e)]:0;++e;const o=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==i||null==o||null==c)throw new a;const h=s<<2|i>>4;if(r.push(h),64!==o){const t=i<<4&240|o>>2;if(r.push(t),64!==c){const t=o<<6&192|c;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class a extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const c=function(t){return function(t){const e=i(t);return o.encodeByteArray(e,!0)}(t).replace(/\./g,"")},h=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return o.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},u=()=>{var t;return null===(t=h())||void 0===t?void 0:t.config};class l{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function f(){try{return"object"==typeof indexedDB}catch(t){return!1}}class p extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,p.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,g.prototype.create)}}class g{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,s=this.errors[t],i=s?function(t,e){return t.replace(m,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${i} (${r}).`;return new p(r,o,n)}}const m=/\{\$([^}]+)}/g;function y(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const n=t[s],i=e[s];if(v(n)&&v(i)){if(!y(n,i))return!1}else if(n!==i)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function v(t){return null!==t&&"object"==typeof t}function w(t){return t&&t._delegate?t._delegate:t}class b{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const E="[DEFAULT]";class _{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new l;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:E})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=E){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=E){return this.instances.has(t)}getOptions(t=E){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&t(i,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===E?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=E){return this.component?this.component.multipleInstances?t:E:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class T{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new _(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const S=[];var C;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(C||(C={}));const I={debug:C.DEBUG,verbose:C.VERBOSE,info:C.INFO,warn:C.WARN,error:C.ERROR,silent:C.SILENT},D=C.INFO,A={[C.DEBUG]:"log",[C.VERBOSE]:"log",[C.INFO]:"info",[C.WARN]:"warn",[C.ERROR]:"error"},k=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),s=A[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${r}]  ${t.name}:`,...n)};class N{constructor(t){this.name=t,this._logLevel=D,this._logHandler=k,this._userLogHandler=null,S.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in C))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?I[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,C.DEBUG,...t),this._logHandler(this,C.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,C.VERBOSE,...t),this._logHandler(this,C.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,C.INFO,...t),this._logHandler(this,C.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,C.WARN,...t),this._logHandler(this,C.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,C.ERROR,...t),this._logHandler(this,C.ERROR,...t)}}const x=(t,e)=>e.some((e=>t instanceof e));let R,L;const O=new WeakMap,M=new WeakMap,P=new WeakMap,V=new WeakMap,F=new WeakMap;let U={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return M.get(t);if("objectStoreNames"===e)return t.objectStoreNames||P.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return j(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function B(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(L||(L=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(q(this),t),j(O.get(this))}:function(...t){return j(e.apply(q(this),t))}:function(t,...n){const r=e.call(q(this),t,...n);return P.set(r,t.sort?t.sort():[t]),j(r)}:(t instanceof IDBTransaction&&function(t){if(M.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",i),t.removeEventListener("abort",i)},s=()=>{e(),r()},i=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",s),t.addEventListener("error",i),t.addEventListener("abort",i)}));M.set(t,e)}(t),x(t,R||(R=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,U):t);var e}function j(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",s),t.removeEventListener("error",i)},s=()=>{e(j(t.result)),r()},i=()=>{n(t.error),r()};t.addEventListener("success",s),t.addEventListener("error",i)}));return e.then((e=>{e instanceof IDBCursor&&O.set(e,t)})).catch((()=>{})),F.set(e,t),e}(t);if(V.has(t))return V.get(t);const e=B(t);return e!==t&&(V.set(t,e),F.set(e,t)),e}const q=t=>F.get(t),$=["get","getKey","getAll","getAllKeys","count"],z=["put","add","delete","clear"],K=new Map;function G(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(K.get(e))return K.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=z.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!$.includes(n))return;const i=async function(t,...e){const i=this.transaction(t,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&i.done]))[0]};return K.set(e,i),i}var H;H=U,U={...H,get:(t,e,n)=>G(t,e)||H.get(t,e,n),has:(t,e)=>!!G(t,e)||H.has(t,e)};class Q{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const W="@firebase/app",X="0.9.29",Y=new N("@firebase/app"),J="@firebase/app-compat",Z="@firebase/analytics-compat",tt="@firebase/analytics",et="@firebase/app-check-compat",nt="@firebase/app-check",rt="@firebase/auth",st="@firebase/auth-compat",it="@firebase/database",ot="@firebase/database-compat",at="@firebase/functions",ct="@firebase/functions-compat",ht="@firebase/installations",ut="@firebase/installations-compat",lt="@firebase/messaging",dt="@firebase/messaging-compat",ft="@firebase/performance",pt="@firebase/performance-compat",gt="@firebase/remote-config",mt="@firebase/remote-config-compat",yt="@firebase/storage",vt="@firebase/storage-compat",wt="@firebase/firestore",bt="@firebase/firestore-compat",Et="firebase",_t="[DEFAULT]",Tt={[W]:"fire-core",[J]:"fire-core-compat",[tt]:"fire-analytics",[Z]:"fire-analytics-compat",[nt]:"fire-app-check",[et]:"fire-app-check-compat",[rt]:"fire-auth",[st]:"fire-auth-compat",[it]:"fire-rtdb",[ot]:"fire-rtdb-compat",[at]:"fire-fn",[ct]:"fire-fn-compat",[ht]:"fire-iid",[ut]:"fire-iid-compat",[lt]:"fire-fcm",[dt]:"fire-fcm-compat",[ft]:"fire-perf",[pt]:"fire-perf-compat",[gt]:"fire-rc",[mt]:"fire-rc-compat",[yt]:"fire-gcs",[vt]:"fire-gcs-compat",[wt]:"fire-fst",[bt]:"fire-fst-compat","fire-js":"fire-js",[Et]:"fire-js-all"},St=new Map,Ct=new Map;function It(t,e){try{t.container.addComponent(e)}catch(n){Y.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Dt(t){const e=t.name;if(Ct.has(e))return Y.debug(`There were multiple attempts to register component ${e}.`),!1;Ct.set(e,t);for(const e of St.values())It(e,t);return!0}const At=new g("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class kt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new b("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw At.create("app-deleted",{appName:this._name})}}function Nt(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:_t,automaticDataCollectionEnabled:!1},e),s=r.name;if("string"!=typeof s||!s)throw At.create("bad-app-name",{appName:String(s)});if(n||(n=u()),!n)throw At.create("no-options");const i=St.get(s);if(i){if(y(n,i.options)&&y(r,i.config))return i;throw At.create("duplicate-app",{appName:s})}const o=new T(s);for(const t of Ct.values())o.addComponent(t);const a=new kt(n,r,o);return St.set(s,a),a}function xt(t,e,n){var r;let s=null!==(r=Tt[t])&&void 0!==r?r:t;n&&(s+=`-${n}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const t=[`Unable to register library "${s}" with version "${e}":`];return i&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void Y.warn(t.join(" "))}Dt(new b(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}const Rt="firebase-heartbeat-database",Lt=1,Ot="firebase-heartbeat-store";let Mt=null;function Pt(){return Mt||(Mt=function(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=j(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(j(o.result),t.oldVersion,t.newVersion,j(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{i&&t.addEventListener("close",(()=>i())),s&&t.addEventListener("versionchange",(t=>s(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(Rt,Lt,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(Ot)}catch(t){console.warn(t)}}}).catch((t=>{throw At.create("idb-open",{originalErrorMessage:t.message})}))),Mt}async function Vt(t,e){try{const n=(await Pt()).transaction(Ot,"readwrite"),r=n.objectStore(Ot);await r.put(e,Ft(t)),await n.done}catch(t){if(t instanceof p)Y.warn(t.message);else{const e=At.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});Y.warn(e.message)}}}function Ft(t){return`${t.name}!${t.options.appId}`}class Ut{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new jt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Bt();if((null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((t=>t.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=Bt(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),qt(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),qt(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=c(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function Bt(){return(new Date).toISOString().substring(0,10)}class jt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!f()&&new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await Pt()).transaction(Ot),n=await e.objectStore(Ot).get(Ft(t));return await e.done,n}catch(t){if(t instanceof p)Y.warn(t.message);else{const e=At.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});Y.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Vt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Vt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function qt(t){return c(JSON.stringify({version:2,heartbeats:t})).length}Dt(new b("platform-logger",(t=>new Q(t)),"PRIVATE")),Dt(new b("heartbeat",(t=>new Ut(t)),"PRIVATE")),xt(W,X,""),xt(W,X,"esm2017"),xt("fire-js",""),xt("firebase","10.9.0","app");var $t,zt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Kt={},Gt=Gt||{},Ht=zt||self;function Qt(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function Wt(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Xt="closure_uid_"+(1e9*Math.random()>>>0),Yt=0;function Jt(t,e,n){return t.call.apply(t.bind,arguments)}function Zt(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function te(t,e,n){return(te=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Jt:Zt).apply(null,arguments)}function ee(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function ne(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}function re(){this.s=this.s,this.o=this.o}re.prototype.s=!1,re.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,Xt)&&t[Xt]||(t[Xt]=++Yt))},re.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const se=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function ie(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function oe(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(Qt(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let s=0;s<r;s++)t[e+s]=n[s]}else t.push(n)}}function ae(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}ae.prototype.h=function(){this.defaultPrevented=!0};var ce=function(){if(!Ht.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};Ht.addEventListener("test",t,e),Ht.removeEventListener("test",t,e)}catch(t){}return t}();function he(t){return/^[\s\xa0]*$/.test(t)}function ue(){var t=Ht.navigator;return t&&(t=t.userAgent)?t:""}function le(t){return-1!=ue().indexOf(t)}function de(t){return de[" "](t),t}de[" "]=function(){};var fe,pe,ge,me=le("Opera"),ye=le("Trident")||le("MSIE"),ve=le("Edge"),we=ve||ye,be=le("Gecko")&&!(-1!=ue().toLowerCase().indexOf("webkit")&&!le("Edge"))&&!(le("Trident")||le("MSIE"))&&!le("Edge"),Ee=-1!=ue().toLowerCase().indexOf("webkit")&&!le("Edge");function _e(){var t=Ht.document;return t?t.documentMode:void 0}t:{var Te="",Se=(pe=ue(),be?/rv:([^\);]+)(\)|;)/.exec(pe):ve?/Edge\/([\d\.]+)/.exec(pe):ye?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(pe):Ee?/WebKit\/(\S+)/.exec(pe):me?/(?:Version)[ \/]?(\S+)/.exec(pe):void 0);if(Se&&(Te=Se?Se[1]:""),ye){var Ce=_e();if(null!=Ce&&Ce>parseFloat(Te)){fe=String(Ce);break t}}fe=Te}Ht.document&&ye?ge=_e()||parseInt(fe,10)||void 0:ge=void 0;var Ie=ge;function De(t,e){if(ae.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(be){t:{try{de(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Ae[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&De.$.h.call(this)}}ne(De,ae);var Ae={2:"touch",3:"pen",4:"mouse"};De.prototype.h=function(){De.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var ke="closure_listenable_"+(1e6*Math.random()|0),Ne=0;function xe(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=s,this.key=++Ne,this.fa=this.ia=!1}function Re(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function Le(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function Oe(t){const e={};for(const n in t)e[n]=t[n];return e}const Me="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Pe(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<Me.length;e++)n=Me[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Ve(t){this.src=t,this.g={},this.h=0}function Fe(t,e){var n=e.type;if(n in t.g){var r,s=t.g[n],i=se(s,e);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(Re(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function Ue(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.fa&&i.listener==e&&i.capture==!!n&&i.la==r)return s}return-1}Ve.prototype.add=function(t,e,n,r,s){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=Ue(t,e,r,s);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new xe(e,this.src,i,!!r,s)).ia=n,t.push(e)),e};var Be="closure_lm_"+(1e6*Math.random()|0),je={};function qe(t,e,n,r,s){if(r&&r.once)return ze(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)qe(t,e[i],n,r,s);return null}return n=Ye(n),t&&t[ke]?t.O(e,n,Wt(r)?!!r.capture:!!r,s):$e(t,e,n,!1,r,s)}function $e(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var o=Wt(s)?!!s.capture:!!s,a=We(t);if(a||(t[Be]=a=new Ve(t)),(n=a.add(e,n,r,o,i)).proxy)return n;if(r=function(){const t=Qe;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)ce||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(He(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function ze(t,e,n,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)ze(t,e[i],n,r,s);return null}return n=Ye(n),t&&t[ke]?t.P(e,n,Wt(r)?!!r.capture:!!r,s):$e(t,e,n,!0,r,s)}function Ke(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)Ke(t,e[i],n,r,s);else r=Wt(r)?!!r.capture:!!r,n=Ye(n),t&&t[ke]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=Ue(i=t.g[e],n,r,s))&&(Re(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--))):t&&(t=We(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Ue(e,n,r,s)),(n=-1<t?e[t]:null)&&Ge(n))}function Ge(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[ke])Fe(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(He(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=We(e))?(Fe(n,t),0==n.h&&(n.src=null,e[Be]=null)):Re(t)}}}function He(t){return t in je?je[t]:je[t]="on"+t}function Qe(t,e){if(t.fa)t=!0;else{e=new De(e,this);var n=t.listener,r=t.la||t.src;t.ia&&Ge(t),t=n.call(r,e)}return t}function We(t){return(t=t[Be])instanceof Ve?t:null}var Xe="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ye(t){return"function"==typeof t?t:(t[Xe]||(t[Xe]=function(e){return t.handleEvent(e)}),t[Xe])}function Je(){re.call(this),this.i=new Ve(this),this.S=this,this.J=null}function Ze(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,"string"==typeof e)e=new ae(e,t);else if(e instanceof ae)e.target=e.target||t;else{var s=e;Pe(e=new ae(r,t),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];s=tn(o,r,!0,e)&&s}if(s=tn(o=e.g=t,r,!0,e)&&s,s=tn(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=tn(o=e.g=n[i],r,!1,e)&&s}function tn(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&Fe(t.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}ne(Je,re),Je.prototype[ke]=!0,Je.prototype.removeEventListener=function(t,e,n,r){Ke(this,t,e,n,r)},Je.prototype.N=function(){if(Je.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Re(n[r]);delete e.g[t],e.h--}}this.J=null},Je.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Je.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var en=Ht.JSON.stringify;function nn(){var t=un;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var rn=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new sn),(t=>t.reset()));class sn{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function on(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function an(t){Ht.setTimeout((()=>{throw t}),0)}let cn,hn=!1,un=new class{constructor(){this.h=this.g=null}add(t,e){const n=rn.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},ln=()=>{const t=Ht.Promise.resolve(void 0);cn=()=>{t.then(dn)}};var dn=()=>{for(var t;t=nn();){try{t.h.call(t.g)}catch(t){an(t)}var e=rn;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}hn=!1};function fn(t,e){Je.call(this),this.h=t||1,this.g=e||Ht,this.j=te(this.qb,this),this.l=Date.now()}function pn(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function gn(t,e,n){if("function"==typeof t)n&&(t=te(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=te(t.handleEvent,t)}return 2147483647<Number(e)?-1:Ht.setTimeout(t,e||0)}function mn(t){t.g=gn((()=>{t.g=null,t.i&&(t.i=!1,mn(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}ne(fn,Je),($t=fn.prototype).ga=!1,$t.T=null,$t.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ze(this,"tick"),this.ga&&(pn(this),this.start()))}},$t.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},$t.N=function(){fn.$.N.call(this),pn(this),delete this.g};class yn extends re{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:mn(this)}N(){super.N(),this.g&&(Ht.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function vn(t){re.call(this),this.h=t,this.g={}}ne(vn,re);var wn=[];function bn(t,e,n,r){Array.isArray(n)||(n&&(wn[0]=n.toString()),n=wn);for(var s=0;s<n.length;s++){var i=qe(e,n[s],r||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function En(t){Le(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Ge(t)}),t),t.g={}}function _n(){this.g=!0}function Tn(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return en(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}vn.prototype.N=function(){vn.$.N.call(this),En(this)},vn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},_n.prototype.Ea=function(){this.g=!1},_n.prototype.info=function(){};var Sn={},Cn=null;function In(){return Cn=Cn||new Je}function Dn(t){ae.call(this,Sn.Ta,t)}function An(t){const e=In();Ze(e,new Dn(e))}function kn(t,e){ae.call(this,Sn.STAT_EVENT,t),this.stat=e}function Nn(t){const e=In();Ze(e,new kn(e,t))}function xn(t,e){ae.call(this,Sn.Ua,t),this.size=e}function Rn(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return Ht.setTimeout((function(){t()}),e)}Sn.Ta="serverreachability",ne(Dn,ae),Sn.STAT_EVENT="statevent",ne(kn,ae),Sn.Ua="timingevent",ne(xn,ae);var Ln={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},On={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Mn(){}function Pn(t){return t.h||(t.h=t.i())}function Vn(){}Mn.prototype.h=null;var Fn,Un={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Bn(){ae.call(this,"d")}function jn(){ae.call(this,"c")}function qn(){}function $n(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new vn(this),this.P=Kn,t=we?125:void 0,this.V=new fn(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new zn}function zn(){this.i=null,this.g="",this.h=!1}ne(Bn,ae),ne(jn,ae),ne(qn,Mn),qn.prototype.g=function(){return new XMLHttpRequest},qn.prototype.i=function(){return{}},Fn=new qn;var Kn=45e3,Gn={},Hn={};function Qn(t,e,n){t.L=1,t.A=fr(cr(e)),t.u=n,t.S=!0,Wn(t,null)}function Wn(t,e){t.G=Date.now(),Zn(t),t.B=cr(t.A);var n=t.B,r=t.W;Array.isArray(r)||(r=[String(r)]),Ir(n.i,"t",r),t.o=0,n=t.l.J,t.h=new zn,t.g=Is(t.l,n?e:null,!t.u),0<t.O&&(t.M=new yn(te(t.Pa,t,t.g),t.O)),bn(t.U,t.g,"readystatechange",t.nb),e=t.I?Oe(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),An(),function(t,e,n,r,s,i){t.info((function(){if(t.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var h=a[c].split("=");if(1<h.length){var u=h[0];h=h[1];var l=u.split("_");o=2<=l.length&&"type"==l[1]?o+(u+"=")+h+"&":o+(u+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.v,t.B,t.m,t.W,t.u)}function Xn(t){return!!t.g&&"GET"==t.v&&2!=t.L&&t.l.Ha}function Yn(t,e,n){let r,s=!0;for(;!t.J&&t.o<n.length;){if(r=Jn(t,n),r==Hn){4==e&&(t.s=4,Nn(14),s=!1),Tn(t.j,t.m,null,"[Incomplete Response]");break}if(r==Gn){t.s=4,Nn(15),Tn(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}Tn(t.j,t.m,r,null),sr(t,r)}Xn(t)&&0!=t.o&&(t.h.g=t.h.g.slice(t.o),t.o=0),4!=e||0!=n.length||t.h.h||(t.s=1,Nn(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),vs(e),e.M=!0,Nn(11))):(Tn(t.j,t.m,n,"[Invalid Chunked Response]"),rr(t),nr(t))}function Jn(t,e){var n=t.o,r=e.indexOf("\n",n);return-1==r?Hn:(n=Number(e.substring(n,r)),isNaN(n)?Gn:(r+=1)+n>e.length?Hn:(e=e.slice(r,r+n),t.o=r+n,e))}function Zn(t){t.Y=Date.now()+t.P,tr(t,t.P)}function tr(t,e){if(null!=t.C)throw Error("WatchDog timer not null");t.C=Rn(te(t.lb,t),e)}function er(t){t.C&&(Ht.clearTimeout(t.C),t.C=null)}function nr(t){0==t.l.H||t.J||Es(t.l,t)}function rr(t){er(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,pn(t.V),En(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function sr(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||Lr(n.i,t)))if(!t.K&&Lr(n.i,t)&&3==n.H){try{var r=n.Ja.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;bs(n),us(n)}ys(n),Nn(18)}}else n.Fa=s[1],0<n.Fa-n.V&&37500>s[2]&&n.G&&0==n.A&&!n.v&&(n.v=Rn(te(n.ib,n),6e3));if(1>=Rr(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else Ts(n,11)}else if((t.K||n.g==t)&&bs(n),!he(e))for(s=n.Ja.g.parse(e),e=0;e<s.length;e++){let h=s[e];if(n.V=h[0],h=h[1],2==n.H)if("c"==h[0]){n.K=h[1],n.pa=h[2];const e=h[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const s=h[4];null!=s&&(n.Ga=s,n.l.info("SVER="+n.Ga));const u=h[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=r.i;i.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Or(i,i.h),i.h=null))}if(r.F){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.Da=t,dr(r.I,r.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((r=n).wa=Cs(r,r.J?r.pa:null,r.Y),o.K){Mr(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(er(a),Zn(a)),r.g=o}else ms(r);0<n.j.length&&ds(n)}else"stop"!=h[0]&&"close"!=h[0]||Ts(n,7);else 3==n.H&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?Ts(n,7):hs(n):"noop"!=h[0]&&n.h&&n.h.Aa(h),n.A=0)}An()}catch(t){}}function ir(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Qt(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(Qt(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(Qt(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),s=r.length,i=0;i<s;i++)e.call(void 0,r[i],n&&n[i],t)}($t=$n.prototype).setTimeout=function(t){this.P=t},$t.nb=function(t){t=t.target;const e=this.M;e&&3==rs(t)?e.l():this.Pa(t)},$t.Pa=function(t){try{if(t==this.g)t:{const u=rs(this.g);var e=this.g.Ia();if(this.g.da(),!(3>u)&&(3!=u||we||this.g&&(this.h.h||this.g.ja()||ss(this.g)))){this.J||4!=u||7==e||An(),er(this);var n=this.g.da();this.ca=n;e:if(Xn(this)){var r=ss(this.g);t="";var s=r.length,i=4==rs(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){rr(this),nr(this);var o="";break e}this.h.i=new Ht.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,r,s,i,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.j,this.v,this.B,this.m,this.W,u,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!he(a)){var h=a;break e}}h=null}if(!(n=h)){this.i=!1,this.s=3,Nn(12),rr(this),nr(this);break t}Tn(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,sr(this,n)}this.S?(Yn(this,u,o),we&&this.i&&3==u&&(bn(this.U,this.V,"tick",this.mb),this.V.start())):(Tn(this.j,this.m,o,null),sr(this,o)),4==u&&rr(this),this.i&&!this.J&&(4==u?Es(this.l,this):(this.i=!1,Zn(this)))}else(function(t){const e={};t=(t.g&&2<=rs(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(he(t[r]))continue;var n=on(t[r]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=e[s]||[];e[s]=i,i.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,Nn(12)):(this.s=0,Nn(13)),rr(this),nr(this)}}}catch(t){}},$t.mb=function(){if(this.g){var t=rs(this.g),e=this.g.ja();this.o<e.length&&(er(this),Yn(this,t,e),this.i&&4!=t&&Zn(this))}},$t.cancel=function(){this.J=!0,rr(this)},$t.lb=function(){this.C=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.B),2!=this.L&&(An(),Nn(17)),rr(this),this.s=2,nr(this)):tr(this,this.Y-t)};var or=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ar(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof ar){this.h=t.h,hr(this,t.j),this.s=t.s,this.g=t.g,ur(this,t.m),this.l=t.l;var e=t.i,n=new _r;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),lr(this,n),this.o=t.o}else t&&(e=String(t).match(or))?(this.h=!1,hr(this,e[1]||"",!0),this.s=pr(e[2]||""),this.g=pr(e[3]||"",!0),ur(this,e[4]),this.l=pr(e[5]||"",!0),lr(this,e[6]||"",!0),this.o=pr(e[7]||"")):(this.h=!1,this.i=new _r(null,this.h))}function cr(t){return new ar(t)}function hr(t,e,n){t.j=n?pr(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function ur(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function lr(t,e,n){e instanceof _r?(t.i=e,function(t,e){e&&!t.j&&(Tr(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Sr(this,e),Ir(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=gr(e,br)),t.i=new _r(e,t.h))}function dr(t,e,n){t.i.set(e,n)}function fr(t){return dr(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function pr(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function gr(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,mr),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function mr(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}ar.prototype.toString=function(){var t=[],e=this.j;e&&t.push(gr(e,yr,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(gr(e,yr,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(gr(n,"/"==n.charAt(0)?wr:vr,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",gr(n,Er)),t.join("")};var yr=/[#\/\?@]/g,vr=/[#\?:]/g,wr=/[#\?]/g,br=/[#\?@]/g,Er=/#/g;function _r(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Tr(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var i=t[n].substring(0,r);s=t[n].substring(r+1)}else i=t[n];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Sr(t,e){Tr(t),e=Dr(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Cr(t,e){return Tr(t),e=Dr(t,e),t.g.has(e)}function Ir(t,e,n){Sr(t,e),0<n.length&&(t.i=null,t.g.set(Dr(t,e),ie(n)),t.h+=n.length)}function Dr(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}($t=_r.prototype).add=function(t,e){Tr(this),this.i=null,t=Dr(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},$t.forEach=function(t,e){Tr(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},$t.ta=function(){Tr(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const s=t[r];for(let t=0;t<s.length;t++)n.push(e[r])}return n},$t.Z=function(t){Tr(this);let e=[];if("string"==typeof t)Cr(this,t)&&(e=e.concat(this.g.get(Dr(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},$t.set=function(t,e){return Tr(this),this.i=null,Cr(this,t=Dr(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},$t.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},$t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const i=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),t.push(s)}}return this.i=t.join("&")};var Ar=class{constructor(t,e){this.g=t,this.map=e}};function kr(t){this.l=t||Nr,t=Ht.PerformanceNavigationTiming?0<(t=Ht.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(Ht.g&&Ht.g.Ka&&Ht.g.Ka()&&Ht.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Nr=10;function xr(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Rr(t){return t.h?1:t.g?t.g.size:0}function Lr(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Or(t,e){t.g?t.g.add(e):t.h=e}function Mr(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Pr(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return ie(t.i)}kr.prototype.cancel=function(){if(this.i=Pr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var Vr=class{stringify(t){return Ht.JSON.stringify(t,void 0)}parse(t){return Ht.JSON.parse(t,void 0)}};function Fr(){this.g=new Vr}function Ur(t,e,n){const r=n||"";try{ir(t,(function(t,n){let s=t;Wt(t)&&(s=en(t)),e.push(r+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Br(t,e,n,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(t){}}function jr(t){this.l=t.ec||null,this.j=t.ob||!1}function qr(t,e){Je.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=$r,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ne(jr,Mn),jr.prototype.g=function(){return new qr(this.l,this.j)},jr.prototype.i=function(t){return function(){return t}}({}),ne(qr,Je);var $r=0;function zr(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function Kr(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Gr(t)}function Gr(t){t.onreadystatechange&&t.onreadystatechange.call(t)}($t=qr.prototype).open=function(t,e){if(this.readyState!=$r)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Gr(this)},$t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||Ht).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},$t.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Kr(this)),this.readyState=$r},$t.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Gr(this)),this.g&&(this.readyState=3,Gr(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==Ht.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;zr(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},$t.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Kr(this):Gr(this),3==this.readyState&&zr(this)}},$t.Za=function(t){this.g&&(this.response=this.responseText=t,Kr(this))},$t.Ya=function(t){this.g&&(this.response=t,Kr(this))},$t.ka=function(){this.g&&Kr(this)},$t.setRequestHeader=function(t,e){this.v.append(t,e)},$t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},$t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(qr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Hr=Ht.JSON.parse;function Qr(t){Je.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Wr,this.L=this.M=!1}ne(Qr,Je);var Wr="",Xr=/^https?$/i,Yr=["POST","PUT"];function Jr(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Zr(t),es(t)}function Zr(t){t.F||(t.F=!0,Ze(t,"complete"),Ze(t,"error"))}function ts(t){if(t.h&&void 0!==Gt&&(!t.C[1]||4!=rs(t)||2!=t.da()))if(t.v&&4==rs(t))gn(t.La,0,t);else if(Ze(t,"readystatechange"),4==rs(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===o){var s=String(t.I).match(or)[1]||null;!s&&Ht.self&&Ht.self.location&&(s=Ht.self.location.protocol.slice(0,-1)),r=!Xr.test(s?s.toLowerCase():"")}n=r}if(n)Ze(t,"complete"),Ze(t,"success");else{t.m=6;try{var i=2<rs(t)?t.g.statusText:""}catch(t){i=""}t.j=i+" ["+t.da()+"]",Zr(t)}}finally{es(t)}}}function es(t,e){if(t.g){ns(t);const n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||Ze(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function ns(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(Ht.clearTimeout(t.A),t.A=null)}function rs(t){return t.g?t.g.readyState:0}function ss(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case Wr:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function is(t){let e="";return Le(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function os(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=is(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):dr(t,e,n))}function as(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function cs(t){this.Ga=0,this.j=[],this.l=new _n,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=as("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=as("baseRetryDelayMs",5e3,t),this.hb=as("retryDelaySeedMs",1e4,t),this.eb=as("forwardChannelMaxRetries",2,t),this.xa=as("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new kr(t&&t.concurrentRequestLimit),this.Ja=new Fr,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function hs(t){if(ls(t),3==t.H){var e=t.W++,n=cr(t.I);if(dr(n,"SID",t.K),dr(n,"RID",e),dr(n,"TYPE","terminate"),ps(t,n),(e=new $n(t,t.l,e)).L=2,e.A=fr(cr(n)),n=!1,Ht.navigator&&Ht.navigator.sendBeacon)try{n=Ht.navigator.sendBeacon(e.A.toString(),"")}catch(t){}!n&&Ht.Image&&((new Image).src=e.A,n=!0),n||(e.g=Is(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Zn(e)}Ss(t)}function us(t){t.g&&(vs(t),t.g.cancel(),t.g=null)}function ls(t){us(t),t.u&&(Ht.clearTimeout(t.u),t.u=null),bs(t),t.i.cancel(),t.m&&("number"==typeof t.m&&Ht.clearTimeout(t.m),t.m=null)}function ds(t){if(!xr(t.i)&&!t.m){t.m=!0;var e=t.Na;cn||ln(),hn||(cn(),hn=!0),un.add(e,t),t.C=0}}function fs(t,e){var n;n=e?e.m:t.W++;const r=cr(t.I);dr(r,"SID",t.K),dr(r,"RID",n),dr(r,"AID",t.V),ps(t,r),t.o&&t.s&&os(r,t.o,t.s),n=new $n(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=gs(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),Or(t.i,n),Qn(n,r,e)}function ps(t,e){t.na&&Le(t.na,(function(t,n){dr(e,n,t)})),t.h&&ir({},(function(t,n){dr(e,n,t)}))}function gs(t,e,n){n=Math.min(t.j.length,n);var r=t.h?te(t.h.Va,t.h,t):null;t:{var s=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let i=!0;for(let o=0;o<n;o++){let n=s[o].g;const a=s[o].map;if(n-=e,0>n)e=Math.max(0,s[o].g-100),i=!1;else try{Ur(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(i){r=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,r}function ms(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;cn||ln(),hn||(cn(),hn=!0),un.add(e,t),t.A=0}}function ys(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=Rn(te(t.Ma,t),_s(t,t.A)),t.A++,0))}function vs(t){null!=t.B&&(Ht.clearTimeout(t.B),t.B=null)}function ws(t){t.g=new $n(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=cr(t.wa);dr(e,"RID","rpc"),dr(e,"SID",t.K),dr(e,"AID",t.V),dr(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&dr(e,"TO",t.qa),dr(e,"TYPE","xmlhttp"),ps(t,e),t.o&&t.s&&os(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=fr(cr(e)),n.u=null,n.S=!0,Wn(n,t)}function bs(t){null!=t.v&&(Ht.clearTimeout(t.v),t.v=null)}function Es(t,e){var n=null;if(t.g==e){bs(t),vs(t),t.g=null;var r=2}else{if(!Lr(t.i,e))return;n=e.F,Mr(t.i,e),r=1}if(0!=t.H)if(e.i)if(1==r){n=e.u?e.u.length:0,e=Date.now()-e.G;var s=t.C;Ze(r=In(),new xn(r,n)),ds(t)}else ms(t);else if(3==(s=e.s)||0==s&&0<e.ca||!(1==r&&function(t,e){return!(Rr(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=Rn(te(t.Na,t,e),_s(t,t.C)),t.C++,0)))}(t,e)||2==r&&ys(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:Ts(t,5);break;case 4:Ts(t,10);break;case 3:Ts(t,6);break;default:Ts(t,2)}}function _s(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Ts(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var r=te(t.pb,t);n||(n=new ar("//www.google.com/images/cleardot.gif"),Ht.location&&"http"==Ht.location.protocol||hr(n,"https"),fr(n)),function(t,e){const n=new _n;if(Ht.Image){const r=new Image;r.onload=ee(Br,n,r,"TestLoadImage: loaded",!0,e),r.onerror=ee(Br,n,r,"TestLoadImage: error",!1,e),r.onabort=ee(Br,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=ee(Br,n,r,"TestLoadImage: timeout",!1,e),Ht.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else Nn(2);t.H=0,t.h&&t.h.za(e),Ss(t),ls(t)}function Ss(t){if(t.H=0,t.ma=[],t.h){const e=Pr(t.i);0==e.length&&0==t.j.length||(oe(t.ma,e),oe(t.ma,t.j),t.i.i.length=0,ie(t.j),t.j.length=0),t.h.ya()}}function Cs(t,e,n){var r=n instanceof ar?cr(n):new ar(n);if(""!=r.g)e&&(r.g=e+"."+r.g),ur(r,r.m);else{var s=Ht.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var i=new ar(null);r&&hr(i,r),e&&(i.g=e),s&&ur(i,s),n&&(i.l=n),r=i}return n=t.F,e=t.Da,n&&e&&dr(r,n,e),dr(r,"VER",t.ra),ps(t,r),r}function Is(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ha&&!t.va?new Qr(new jr({ob:n})):new Qr(t.va)).Oa(t.J),e}function Ds(){}function As(){if(ye&&!(10<=Number(Ie)))throw Error("Environmental error: no available transport.")}function ks(t,e){Je.call(this),this.g=new cs(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!he(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!he(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Rs(this)}function Ns(t){Bn.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function xs(){jn.call(this),this.status=1}function Rs(t){this.g=t}function Ls(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Os(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var s=0;16>s;++s)r[s]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(s=0;16>s;++s)r[s]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],s=t.g[2];var i=t.g[3],o=e+(i^n&(s^i))+r[0]+3614090360&4294967295;o=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=n+(o<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^i&(n^s))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^s^i)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(s^(n|~i))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(e=n+((o=e+(s^(n|~i))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=i+((o=s+(e^(i|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+s&4294967295,t.g[3]=t.g[3]+i&4294967295}function Ms(t,e){this.h=e;for(var n=[],r=!0,s=t.length-1;0<=s;s--){var i=0|t[s];r&&i==e||(n[s]=i,r=!1)}this.g=n}($t=Qr.prototype).Oa=function(t){this.M=t},$t.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Fn.g(),this.C=this.u?Pn(this.u):Pn(Fn),this.g.onreadystatechange=te(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void Jr(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=Ht.FormData&&t instanceof Ht.FormData,!(0<=se(Yr,e))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{ns(this),0<this.B&&((this.L=function(t){return ye&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=te(this.ua,this)):this.A=gn(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Jr(this,t)}},$t.ua=function(){void 0!==Gt&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ze(this,"timeout"),this.abort(8))},$t.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Ze(this,"complete"),Ze(this,"abort"),es(this))},$t.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),es(this,!0)),Qr.$.N.call(this)},$t.La=function(){this.s||(this.G||this.v||this.l?ts(this):this.kb())},$t.kb=function(){ts(this)},$t.isActive=function(){return!!this.g},$t.da=function(){try{return 2<rs(this)?this.g.status:-1}catch(t){return-1}},$t.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},$t.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Hr(e)}},$t.Ia=function(){return this.m},$t.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},($t=cs.prototype).ra=8,$t.H=1,$t.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const s=new $n(this,this.l,t);let i=this.s;if(this.U&&(i?(i=Oe(i),Pe(i,this.U)):i=this.U),null!==this.o||this.O||(s.I=i,i=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=gs(this,s,e),dr(n=cr(this.I),"RID",t),dr(n,"CVER",22),this.F&&dr(n,"X-HTTP-Session-Id",this.F),ps(this,n),i&&(this.O?e="headers="+encodeURIComponent(String(is(i)))+"&"+e:this.o&&os(n,this.o,i)),Or(this.i,s),this.bb&&dr(n,"TYPE","init"),this.P?(dr(n,"$req",e),dr(n,"SID","null"),s.aa=!0,Qn(s,n,null)):Qn(s,n,e),this.H=2}}else 3==this.H&&(t?fs(this,t):0==this.j.length||xr(this.i)||fs(this))},$t.Ma=function(){if(this.u=null,ws(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=Rn(te(this.jb,this),t)}},$t.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Nn(10),us(this),ws(this))},$t.ib=function(){null!=this.v&&(this.v=null,us(this),ys(this),Nn(19))},$t.pb=function(t){t?(this.l.info("Successfully pinged google.com"),Nn(2)):(this.l.info("Failed to ping google.com"),Nn(1))},$t.isActive=function(){return!!this.h&&this.h.isActive(this)},($t=Ds.prototype).Ba=function(){},$t.Aa=function(){},$t.za=function(){},$t.ya=function(){},$t.isActive=function(){return!0},$t.Va=function(){},As.prototype.g=function(t,e){return new ks(t,e)},ne(ks,Je),ks.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;Nn(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=Cs(t,null,t.Y),ds(t)},ks.prototype.close=function(){hs(this.g)},ks.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=en(t),t=n);e.j.push(new Ar(e.fb++,t)),3==e.H&&ds(e)},ks.prototype.N=function(){this.g.h=null,delete this.j,hs(this.g),delete this.g,ks.$.N.call(this)},ne(Ns,Bn),ne(xs,jn),ne(Rs,Ds),Rs.prototype.Ba=function(){Ze(this.g,"a")},Rs.prototype.Aa=function(t){Ze(this.g,new Ns(t))},Rs.prototype.za=function(t){Ze(this.g,new xs)},Rs.prototype.ya=function(){Ze(this.g,"b")},ne(Ls,(function(){this.blockSize=-1})),Ls.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Ls.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=this.m,s=this.h,i=0;i<e;){if(0==s)for(;i<=n;)Os(this,t,i),i+=this.blockSize;if("string"==typeof t){for(;i<e;)if(r[s++]=t.charCodeAt(i++),s==this.blockSize){Os(this,r),s=0;break}}else for(;i<e;)if(r[s++]=t[i++],s==this.blockSize){Os(this,r),s=0;break}}this.h=s,this.i+=e},Ls.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var Ps={};function Vs(t){return-128<=t&&128>t?function(t,e){var n=Ps;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new Ms([0|t],0>t?-1:0)}(t)}(t):new Ms([0|t],0>t?-1:0)}function Fs(t){if(isNaN(t)||!isFinite(t))return Bs;if(0>t)return Ks(Fs(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=Us;return new Ms(e,0)}var Us=4294967296,Bs=Vs(0),js=Vs(1),qs=Vs(16777216);function $s(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function zs(t){return-1==t.h}function Ks(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new Ms(n,~t.h).add(js)}function Gs(t,e){return t.add(Ks(e))}function Hs(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function Qs(t,e){this.g=t,this.h=e}function Ws(t,e){if($s(e))throw Error("division by zero");if($s(t))return new Qs(Bs,Bs);if(zs(t))return e=Ws(Ks(t),e),new Qs(Ks(e.g),Ks(e.h));if(zs(e))return e=Ws(t,Ks(e)),new Qs(Ks(e.g),e.h);if(30<t.g.length){if(zs(t)||zs(e))throw Error("slowDivide_ only works with positive integers.");for(var n=js,r=e;0>=r.X(t);)n=Xs(n),r=Xs(r);var s=Ys(n,1),i=Ys(r,1);for(r=Ys(r,2),n=Ys(n,2);!$s(r);){var o=i.add(r);0>=o.X(t)&&(s=s.add(n),i=o),r=Ys(r,1),n=Ys(n,1)}return e=Gs(t,s.R(e)),new Qs(s,e)}for(s=Bs;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(i=Fs(n)).R(e);zs(o)||0<o.X(t);)o=(i=Fs(n-=r)).R(e);$s(i)&&(i=js),s=s.add(i),t=Gs(t,o)}return new Qs(s,t)}function Xs(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new Ms(n,t.h)}function Ys(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,s=[],i=0;i<r;i++)s[i]=0<e?t.D(i+n)>>>e|t.D(i+n+1)<<32-e:t.D(i+n);return new Ms(s,t.h)}($t=Ms.prototype).ea=function(){if(zs(this))return-Ks(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:Us+r)*e,e*=Us}return t},$t.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if($s(this))return"0";if(zs(this))return"-"+Ks(this).toString(t);for(var e=Fs(Math.pow(t,6)),n=this,r="";;){var s=Ws(n,e).g,i=((0<(n=Gs(n,s.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if($s(n=s))return i+r;for(;6>i.length;)i="0"+i;r=i+r}},$t.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},$t.X=function(t){return zs(t=Gs(this,t))?-1:$s(t)?0:1},$t.abs=function(){return zs(this)?Ks(this):this},$t.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,s=0;s<=e;s++){var i=r+(65535&this.D(s))+(65535&t.D(s)),o=(i>>>16)+(this.D(s)>>>16)+(t.D(s)>>>16);r=o>>>16,i&=65535,o&=65535,n[s]=o<<16|i}return new Ms(n,-2147483648&n[n.length-1]?-1:0)},$t.R=function(t){if($s(this)||$s(t))return Bs;if(zs(this))return zs(t)?Ks(this).R(Ks(t)):Ks(Ks(this).R(t));if(zs(t))return Ks(this.R(Ks(t)));if(0>this.X(qs)&&0>t.X(qs))return Fs(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<t.g.length;s++){var i=this.D(r)>>>16,o=65535&this.D(r),a=t.D(s)>>>16,c=65535&t.D(s);n[2*r+2*s]+=o*c,Hs(n,2*r+2*s),n[2*r+2*s+1]+=i*c,Hs(n,2*r+2*s+1),n[2*r+2*s+1]+=o*a,Hs(n,2*r+2*s+1),n[2*r+2*s+2]+=i*a,Hs(n,2*r+2*s+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new Ms(n,0)},$t.gb=function(t){return Ws(this,t).h},$t.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new Ms(n,this.h&t.h)},$t.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new Ms(n,this.h|t.h)},$t.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new Ms(n,this.h^t.h)},As.prototype.createWebChannel=As.prototype.g,ks.prototype.send=ks.prototype.u,ks.prototype.open=ks.prototype.m,ks.prototype.close=ks.prototype.close,Ln.NO_ERROR=0,Ln.TIMEOUT=8,Ln.HTTP_ERROR=6,On.COMPLETE="complete",Vn.EventType=Un,Un.OPEN="a",Un.CLOSE="b",Un.ERROR="c",Un.MESSAGE="d",Je.prototype.listen=Je.prototype.O,Qr.prototype.listenOnce=Qr.prototype.P,Qr.prototype.getLastError=Qr.prototype.Sa,Qr.prototype.getLastErrorCode=Qr.prototype.Ia,Qr.prototype.getStatus=Qr.prototype.da,Qr.prototype.getResponseJson=Qr.prototype.Wa,Qr.prototype.getResponseText=Qr.prototype.ja,Qr.prototype.send=Qr.prototype.ha,Qr.prototype.setWithCredentials=Qr.prototype.Oa,Ls.prototype.digest=Ls.prototype.l,Ls.prototype.reset=Ls.prototype.reset,Ls.prototype.update=Ls.prototype.j,Ms.prototype.add=Ms.prototype.add,Ms.prototype.multiply=Ms.prototype.R,Ms.prototype.modulo=Ms.prototype.gb,Ms.prototype.compare=Ms.prototype.X,Ms.prototype.toNumber=Ms.prototype.ea,Ms.prototype.toString=Ms.prototype.toString,Ms.prototype.getBits=Ms.prototype.D,Ms.fromNumber=Fs,Ms.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return Ks(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=Fs(Math.pow(n,8)),s=Bs,i=0;i<e.length;i+=8){var o=Math.min(8,e.length-i),a=parseInt(e.substring(i,i+o),n);8>o?(o=Fs(Math.pow(n,o)),s=s.R(o).add(Fs(a))):s=(s=s.R(r)).add(Fs(a))}return s};var Js=Kt.createWebChannelTransport=function(){return new As},Zs=Kt.getStatEventTarget=function(){return In()},ti=Kt.ErrorCode=Ln,ei=Kt.EventType=On,ni=Kt.Event=Sn,ri=Kt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},si=(Kt.FetchXmlHttpFactory=jr,Kt.WebChannel=Vn),ii=Kt.XhrIo=Qr,oi=Kt.Md5=Ls,ai=Kt.Integer=Ms;const ci="@firebase/firestore";class hi{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}hi.UNAUTHENTICATED=new hi(null),hi.GOOGLE_CREDENTIALS=new hi("google-credentials-uid"),hi.FIRST_PARTY=new hi("first-party-uid"),hi.MOCK_USER=new hi("mock-user");let ui="10.9.0";const li=new N("@firebase/firestore");function di(){return li.logLevel}function fi(t,...e){if(li.logLevel<=C.DEBUG){const n=e.map(mi);li.debug(`Firestore (${ui}): ${t}`,...n)}}function pi(t,...e){if(li.logLevel<=C.ERROR){const n=e.map(mi);li.error(`Firestore (${ui}): ${t}`,...n)}}function gi(t,...e){if(li.logLevel<=C.WARN){const n=e.map(mi);li.warn(`Firestore (${ui}): ${t}`,...n)}}function mi(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function yi(t="Unexpected state"){const e=`FIRESTORE (${ui}) INTERNAL ASSERTION FAILED: `+t;throw pi(e),new Error(e)}function vi(t,e){t||yi()}function wi(t,e){return t}const bi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ei extends p{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class _i{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Ti{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Si{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(hi.UNAUTHENTICATED)))}shutdown(){}}class Ci{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Ii{constructor(t){this.t=t,this.currentUser=hi.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new _i;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new _i,t.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{fi("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(fi("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new _i)}}),0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(fi("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(vi("string"==typeof e.accessToken),new Ti(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return vi(null===t||"string"==typeof t),new hi(t)}}class Di{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=hi.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Ai{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Di(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(hi.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ki{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ni{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&fi("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,fi("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{fi("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?r(t):fi("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(vi("string"==typeof t.token),this.R=t.token,new ki(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function xi(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Ri{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=xi(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function Li(t,e){return t<e?-1:t>e?1:0}function Oi(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}class Mi{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Ei(bi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Ei(bi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Ei(bi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Ei(bi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Mi.fromMillis(Date.now())}static fromDate(t){return Mi.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new Mi(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Li(this.nanoseconds,t.nanoseconds):Li(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Pi{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Pi(t)}static min(){return new Pi(new Mi(0,0))}static max(){return new Pi(new Mi(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Vi{constructor(t,e,n){void 0===e?e=0:e>t.length&&yi(),void 0===n?n=t.length-e:n>t.length-e&&yi(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===Vi.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Vi?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Fi extends Vi{construct(t,e,n){return new Fi(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Ei(bi.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new Fi(e)}static emptyPath(){return new Fi([])}}const Ui=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Bi extends Vi{construct(t,e,n){return new Bi(t,e,n)}static isValidIdentifier(t){return Ui.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Bi.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Bi(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new Ei(bi.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Ei(bi.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Ei(bi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new Ei(bi.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Bi(e)}static emptyPath(){return new Bi([])}}class ji{constructor(t){this.path=t}static fromPath(t){return new ji(Fi.fromString(t))}static fromName(t){return new ji(Fi.fromString(t).popFirst(5))}static empty(){return new ji(Fi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Fi.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Fi.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new ji(new Fi(t.slice()))}}function qi(t){return new $i(t.readTime,t.key,-1)}class $i{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new $i(Pi.min(),ji.empty(),-1)}static max(){return new $i(Pi.max(),ji.empty(),-1)}}function zi(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=ji.comparator(t.documentKey,e.documentKey),0!==n?n:Li(t.largestBatchId,e.largestBatchId))}const Ki="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Gi{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Hi(t){if(t.code!==bi.FAILED_PRECONDITION||t.message!==Ki)throw t;fi("LocalStore","Unexpectedly lost primary lease")}class Qi{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&yi(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Qi(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Qi?e:Qi.resolve(e)}catch(t){return Qi.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Qi.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Qi.reject(e)}static resolve(t){return new Qi(((e,n)=>{e(t)}))}static reject(t){return new Qi(((e,n)=>{n(t)}))}static waitFor(t){return new Qi(((e,n)=>{let r=0,s=0,i=!1;t.forEach((t=>{++r,t.next((()=>{++s,i&&s===r&&e()}),(t=>n(t)))})),i=!0,s===r&&e()}))}static or(t){let e=Qi.resolve(!1);for(const n of t)e=e.next((t=>t?Qi.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new Qi(((n,r)=>{const s=t.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;e(t[c]).next((t=>{i[c]=t,++o,o===s&&n(i)}),(t=>r(t)))}}))}static doWhile(t,e){return new Qi(((n,r)=>{const s=()=>{!0===t()?e().next((()=>{s()}),r):n()};s()}))}}class Wi{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new _i,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new Ji(t,e.error)):this.V.resolve()},this.transaction.onerror=e=>{const n=ro(e.target.error);this.V.reject(new Ji(t,n))}}static open(t,e,n,r){try{return new Wi(e,t.transaction(r,n))}catch(t){throw new Ji(e,t)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(fi("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new to(e)}}class Xi{constructor(t,e,n){this.name=t,this.version=e,this.p=n,12.2===Xi.S(d())&&pi("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return fi("SimpleDb","Removing database:",t),eo(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!f())return!1;if(Xi.C())return!0;const t=d(),e=Xi.S(t),n=0<e&&e<10,r=Xi.v(t),s=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static C(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.__PRIVATE_env)||void 0===t?void 0:t.F)}static M(t,e){return t.store(e)}static S(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(t){return this.db||(fi("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{const n=t.target.result;e(n)},r.onblocked=()=>{n(new Ji(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;"VersionError"===r.name?n(new Ei(bi.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Ei(bi.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Ji(t,r))},r.onupgradeneeded=t=>{fi("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.p.N(e,r.transaction,t.oldVersion,this.version).next((()=>{fi("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.L&&(this.db.onversionchange=t=>this.L(t)),this.db}B(t){this.L=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const s="readonly"===e;let i=0;for(;;){++i;try{this.db=await this.O(t);const e=Wi.open(this.db,t,s?"readonly":"readwrite",n),i=r(e).next((t=>(e.g(),t))).catch((t=>(e.abort(t),Qi.reject(t)))).toPromise();return i.catch((()=>{})),await e.m,i}catch(t){const e=t,n="FirebaseError"!==e.name&&i<3;if(fi("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Yi{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return eo(this.k.delete())}}class Ji extends Ei{constructor(t,e){super(bi.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Zi(t){return"IndexedDbTransactionError"===t.name}class to{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(fi("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(fi("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),eo(n)}add(t){return fi("SimpleDb","ADD",this.store.name,t,t),eo(this.store.add(t))}get(t){return eo(this.store.get(t)).next((e=>(void 0===e&&(e=null),fi("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return fi("SimpleDb","DELETE",this.store.name,t),eo(this.store.delete(t))}count(){return fi("SimpleDb","COUNT",this.store.name),eo(this.store.count())}W(t,e){const n=this.options(t,e),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const t=r.getAll(n.range);return new Qi(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}{const t=this.cursor(n),e=[];return this.G(t,((t,n)=>{e.push(n)})).next((()=>e))}}j(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new Qi(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}H(t,e){fi("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.J=!1;const r=this.cursor(n);return this.G(r,((t,e,n)=>n.delete()))}Y(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.G(r,e)}Z(t){const e=this.cursor({});return new Qi(((n,r)=>{e.onerror=t=>{const e=ro(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next((t=>{t?r.continue():n()})):n()}}))}G(t,e){const n=[];return new Qi(((r,s)=>{t.onerror=t=>{s(t.target.error)},t.onsuccess=t=>{const s=t.target.result;if(!s)return void r();const i=new Yi(s),o=e(s.primaryKey,s.value,i);if(o instanceof Qi){const t=o.catch((t=>(i.done(),Qi.reject(t))));n.push(t)}i.isDone?r():null===i.$?s.continue():s.continue(i.$)}})).next((()=>Qi.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.J?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function eo(t){return new Qi(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=ro(t.target.error);n(e)}}))}let no=!1;function ro(t){const e=Xi.S(d());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Ei("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return no||(no=!0,setTimeout((()=>{throw t}),0)),t}}return t}class so{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.se(t),this.oe=t=>e.writeSequenceNumber(t))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}function io(t){return null==t}function oo(t){return 0===t&&1/t==-1/0}so._e=-1;function ao(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function co(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ho(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class uo{constructor(t,e){this.comparator=t,this.root=e||fo.EMPTY}insert(t,e){return new uo(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,fo.BLACK,null,null))}remove(t){return new uo(this.comparator,this.root.remove(t,this.comparator).copy(null,null,fo.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new lo(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new lo(this.root,t,this.comparator,!1)}getReverseIterator(){return new lo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new lo(this.root,t,this.comparator,!0)}}class lo{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class fo{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:fo.RED,this.left=null!=r?r:fo.EMPTY,this.right=null!=s?s:fo.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new fo(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return fo.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return fo.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,fo.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,fo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw yi();if(this.right.isRed())throw yi();const t=this.left.check();if(t!==this.right.check())throw yi();return t+(this.isRed()?0:1)}}fo.EMPTY=null,fo.RED=!0,fo.BLACK=!1,fo.EMPTY=new class{constructor(){this.size=0}get key(){throw yi()}get value(){throw yi()}get color(){throw yi()}get left(){throw yi()}get right(){throw yi()}copy(t,e,n,r,s){return this}insert(t,e,n){return new fo(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class po{constructor(t){this.comparator=t,this.data=new uo(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new go(this.data.getIterator())}getIteratorFrom(t){return new go(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof po))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new po(this.comparator);return e.data=t,e}}class go{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class mo{constructor(t){this.fields=t,t.sort(Bi.comparator)}static empty(){return new mo([])}unionWith(t){let e=new po(Bi.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new mo(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Oi(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class yo extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class vo{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new yo("Invalid base64 string: "+t):t}}(t);return new vo(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new vo(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Li(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}vo.EMPTY_BYTE_STRING=new vo("");const wo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function bo(t){if(vi(!!t),"string"==typeof t){let e=0;const n=wo.exec(t);if(vi(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Eo(t.seconds),nanos:Eo(t.nanos)}}function Eo(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function _o(t){return"string"==typeof t?vo.fromBase64String(t):vo.fromUint8Array(t)}function To(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function So(t){const e=t.mapValue.fields.__previous_value__;return To(e)?So(e):e}function Co(t){const e=bo(t.mapValue.fields.__local_write_time__.timestampValue);return new Mi(e.seconds,e.nanos)}class Io{constructor(t,e,n,r,s,i,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Do{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Do("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Do&&t.projectId===this.projectId&&t.database===this.database}}const Ao={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function ko(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?To(t)?4:qo(t)?9007199254740991:10:yi()}function No(t,e){if(t===e)return!0;const n=ko(t);if(n!==ko(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Co(t).isEqual(Co(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=bo(t.timestampValue),r=bo(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return _o(t.bytesValue).isEqual(_o(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Eo(t.geoPointValue.latitude)===Eo(e.geoPointValue.latitude)&&Eo(t.geoPointValue.longitude)===Eo(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Eo(t.integerValue)===Eo(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Eo(t.doubleValue),r=Eo(e.doubleValue);return n===r?oo(n)===oo(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Oi(t.arrayValue.values||[],e.arrayValue.values||[],No);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(ao(n)!==ao(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!No(n[t],r[t])))return!1;return!0}(t,e);default:return yi()}}function xo(t,e){return void 0!==(t.values||[]).find((t=>No(t,e)))}function Ro(t,e){if(t===e)return 0;const n=ko(t),r=ko(e);if(n!==r)return Li(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Li(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Eo(t.integerValue||t.doubleValue),r=Eo(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Lo(t.timestampValue,e.timestampValue);case 4:return Lo(Co(t),Co(e));case 5:return Li(t.stringValue,e.stringValue);case 6:return function(t,e){const n=_o(t),r=_o(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=Li(n[t],r[t]);if(0!==e)return e}return Li(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Li(Eo(t.latitude),Eo(e.latitude));return 0!==n?n:Li(Eo(t.longitude),Eo(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=Ro(n[t],r[t]);if(e)return e}return Li(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Ao.mapValue&&e===Ao.mapValue)return 0;if(t===Ao.mapValue)return 1;if(e===Ao.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let t=0;t<r.length&&t<i.length;++t){const e=Li(r[t],i[t]);if(0!==e)return e;const o=Ro(n[r[t]],s[i[t]]);if(0!==o)return o}return Li(r.length,i.length)}(t.mapValue,e.mapValue);default:throw yi()}}function Lo(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Li(t,e);const n=bo(t),r=bo(e),s=Li(n.seconds,r.seconds);return 0!==s?s:Li(n.nanos,r.nanos)}function Oo(t){return Mo(t)}function Mo(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=bo(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return _o(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return ji.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=Mo(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+=`${s}:${Mo(t.fields[s])}`;return n+"}"}(t.mapValue):yi()}function Po(t){return!!t&&"integerValue"in t}function Vo(t){return!!t&&"arrayValue"in t}function Fo(t){return!!t&&"nullValue"in t}function Uo(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Bo(t){return!!t&&"mapValue"in t}function jo(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return co(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=jo(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=jo(t.arrayValue.values[n]);return e}return Object.assign({},t)}function qo(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class $o{constructor(t){this.value=t}static empty(){return new $o({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Bo(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=jo(e)}setAll(t){let e=Bi.emptyPath(),n={},r=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=s.popLast()}t?n[s.lastSegment()]=jo(t):r.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,r)}delete(t){const e=this.field(t.popLast());Bo(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return No(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];Bo(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){co(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new $o(jo(this.value))}}function zo(t){const e=[];return co(t.fields,((t,n)=>{const r=new Bi([t]);if(Bo(n)){const t=zo(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new mo(e)}class Ko{constructor(t,e,n,r,s,i,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(t){return new Ko(t,0,Pi.min(),Pi.min(),Pi.min(),$o.empty(),0)}static newFoundDocument(t,e,n,r){return new Ko(t,1,e,Pi.min(),n,r,0)}static newNoDocument(t,e){return new Ko(t,2,e,Pi.min(),Pi.min(),$o.empty(),0)}static newUnknownDocument(t,e){return new Ko(t,3,e,Pi.min(),Pi.min(),$o.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(Pi.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=$o.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=$o.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Pi.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Ko&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Ko(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Go{constructor(t,e){this.position=t,this.inclusive=e}}function Ho(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.isKeyField()?ji.comparator(ji.fromName(o.referenceValue),n.key):Ro(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Qo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!No(t.position[n],e.position[n]))return!1;return!0}class Wo{constructor(t,e="asc"){this.field=t,this.dir=e}}function Xo(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Yo{}class Jo extends Yo{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new ia(t,e,n):"array-contains"===e?new ha(t,n):"in"===e?new ua(t,n):"not-in"===e?new la(t,n):"array-contains-any"===e?new da(t,n):new Jo(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new oa(t,n):new aa(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(Ro(e,this.value)):null!==e&&ko(this.value)===ko(e)&&this.matchesComparison(Ro(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return yi()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Zo extends Yo{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new Zo(t,e)}matches(t){return ta(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function ta(t){return"and"===t.op}function ea(t){return function(t){for(const e of t.filters)if(e instanceof Zo)return!1;return!0}(t)&&ta(t)}function na(t){if(t instanceof Jo)return t.field.canonicalString()+t.op.toString()+Oo(t.value);if(ea(t))return t.filters.map((t=>na(t))).join(",");{const e=t.filters.map((t=>na(t))).join(",");return`${t.op}(${e})`}}function ra(t,e){return t instanceof Jo?function(t,e){return e instanceof Jo&&t.op===e.op&&t.field.isEqual(e.field)&&No(t.value,e.value)}(t,e):t instanceof Zo?function(t,e){return e instanceof Zo&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&ra(n,e.filters[r])),!0)}(t,e):void yi()}function sa(t){return t instanceof Jo?function(t){return`${t.field.canonicalString()} ${t.op} ${Oo(t.value)}`}(t):t instanceof Zo?function(t){return t.op.toString()+" {"+t.getFilters().map(sa).join(" ,")+"}"}(t):"Filter"}class ia extends Jo{constructor(t,e,n){super(t,e,n),this.key=ji.fromName(n.referenceValue)}matches(t){const e=ji.comparator(t.key,this.key);return this.matchesComparison(e)}}class oa extends Jo{constructor(t,e){super(t,"in",e),this.keys=ca(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class aa extends Jo{constructor(t,e){super(t,"not-in",e),this.keys=ca(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function ca(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>ji.fromName(t.referenceValue)))}class ha extends Jo{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Vo(e)&&xo(e.arrayValue,this.value)}}class ua extends Jo{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&xo(this.value.arrayValue,e)}}class la extends Jo{constructor(t,e){super(t,"not-in",e)}matches(t){if(xo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!xo(this.value.arrayValue,e)}}class da extends Jo{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Vo(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>xo(this.value.arrayValue,t)))}}class fa{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.ce=null}}function pa(t,e=null,n=[],r=[],s=null,i=null,o=null){return new fa(t,e,n,r,s,i,o)}function ga(t){const e=wi(t);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>na(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),io(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Oo(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Oo(t))).join(",")),e.ce=t}return e.ce}function ma(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Xo(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!ra(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Qo(t.startAt,e.startAt)&&Qo(t.endAt,e.endAt)}function ya(t){return ji.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class va{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function wa(t){return new va(t)}function ba(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Ea(t){const e=wi(t);if(null===e.le){e.le=[];const t=new Set;for(const n of e.explicitOrderBy)e.le.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new po(Bi.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.le.push(new Wo(r,n))})),t.has(Bi.keyField().canonicalString())||e.le.push(new Wo(Bi.keyField(),n))}return e.le}function _a(t){const e=wi(t);return e.he||(e.he=function(t,e){if("F"===t.limitType)return pa(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new Wo(t.field,e)}));const n=t.endAt?new Go(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Go(t.startAt.position,t.startAt.inclusive):null;return pa(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,Ea(t))),e.he}function Ta(t,e,n){return new va(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Sa(t,e){return ma(_a(t),_a(e))&&t.limitType===e.limitType}function Ca(t){return`${ga(_a(t))}|lt:${t.limitType}`}function Ia(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>sa(t))).join(", ")}]`),io(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Oo(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Oo(t))).join(",")),`Target(${e})`}(_a(t))}; limitType=${t.limitType})`}function Da(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):ji.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Ea(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=Ho(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,Ea(t),e)||t.endAt&&!function(t,e,n){const r=Ho(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,Ea(t),e))}(t,e)}function Aa(t){return(e,n)=>{let r=!1;for(const s of Ea(t)){const t=ka(s,e,n);if(0!==t)return t;r=r||s.field.isKeyField()}return 0}}function ka(t,e,n){const r=t.field.isKeyField()?ji.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),s=n.data.field(t);return null!==r&&null!==s?Ro(r,s):yi()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return yi()}}class Na{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){co(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return ho(this.inner)}size(){return this.innerSize}}const xa=new uo(ji.comparator);function Ra(){return xa}const La=new uo(ji.comparator);function Oa(...t){let e=La;for(const n of t)e=e.insert(n.key,n);return e}function Ma(t){let e=La;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Pa(){return Fa()}function Va(){return Fa()}function Fa(){return new Na((t=>t.toString()),((t,e)=>t.isEqual(e)))}const Ua=new uo(ji.comparator),Ba=new po(ji.comparator);function ja(...t){let e=Ba;for(const n of t)e=e.add(n);return e}const qa=new po(Li);function $a(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:oo(e)?"-0":e}}function za(t){return{integerValue:""+t}}function Ka(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!oo(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?za(e):$a(t,e)}class Ga{constructor(){this._=void 0}}function Ha(t,e,n){return t instanceof Xa?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&To(e)&&(e=So(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Ya?Ja(t,e):t instanceof Za?tc(t,e):function(t,e){const n=Wa(t,e),r=nc(n)+nc(t.Ie);return Po(n)&&Po(t.Ie)?za(r):$a(t.serializer,r)}(t,e)}function Qa(t,e,n){return t instanceof Ya?Ja(t,e):t instanceof Za?tc(t,e):n}function Wa(t,e){return t instanceof ec?function(t){return Po(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class Xa extends Ga{}class Ya extends Ga{constructor(t){super(),this.elements=t}}function Ja(t,e){const n=rc(e);for(const e of t.elements)n.some((t=>No(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Za extends Ga{constructor(t){super(),this.elements=t}}function tc(t,e){let n=rc(e);for(const e of t.elements)n=n.filter((t=>!No(t,e)));return{arrayValue:{values:n}}}class ec extends Ga{constructor(t,e){super(),this.serializer=t,this.Ie=e}}function nc(t){return Eo(t.integerValue||t.doubleValue)}function rc(t){return Vo(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class sc{constructor(t,e){this.version=t,this.transformResults=e}}class ic{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new ic}static exists(t){return new ic(void 0,t)}static updateTime(t){return new ic(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function oc(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class ac{}function cc(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new vc(t.key,ic.none()):new fc(t.key,t.data,ic.none());{const n=t.data,r=$o.empty();let s=new po(Bi.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),s=s.add(t)}return new pc(t.key,r,new mo(s.toArray()),ic.none())}}function hc(t,e,n){t instanceof fc?function(t,e,n){const r=t.value.clone(),s=mc(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof pc?function(t,e,n){if(!oc(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=mc(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(gc(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function uc(t,e,n,r){return t instanceof fc?function(t,e,n,r){if(!oc(t.precondition,e))return n;const s=t.value.clone(),i=yc(t.fieldTransforms,r,e);return s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,r):t instanceof pc?function(t,e,n,r){if(!oc(t.precondition,e))return n;const s=yc(t.fieldTransforms,r,e),i=e.data;return i.setAll(gc(t)),i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return oc(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function lc(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),s=Wa(r.transform,t||null);null!=s&&(null===n&&(n=$o.empty()),n.set(r.field,s))}return n||null}function dc(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Oi(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ya&&e instanceof Ya||t instanceof Za&&e instanceof Za?Oi(t.elements,e.elements,No):t instanceof ec&&e instanceof ec?No(t.Ie,e.Ie):t instanceof Xa&&e instanceof Xa}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class fc extends ac{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class pc extends ac{constructor(t,e,n,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function gc(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function mc(t,e,n){const r=new Map;vi(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Qa(o,a,n[s]))}return r}function yc(t,e,n){const r=new Map;for(const s of t){const t=s.transform,i=n.data.field(s.field);r.set(s.field,Ha(t,i,e))}return r}class vc extends ac{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class wc extends ac{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class bc{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&hc(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=uc(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=uc(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Va();return this.mutations.forEach((r=>{const s=t.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=e.has(r.key)?null:o;const a=cc(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(Pi.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),ja())}isEqual(t){return this.batchId===t.batchId&&Oi(this.mutations,t.mutations,((t,e)=>dc(t,e)))&&Oi(this.baseMutations,t.baseMutations,((t,e)=>dc(t,e)))}}class Ec{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){vi(t.mutations.length===n.length);let r=Ua;const s=t.mutations;for(let t=0;t<s.length;t++)r=r.insert(s[t].key,n[t].version);return new Ec(t,e,n,r)}}class _c{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Tc{constructor(t,e){this.count=t,this.unchangedNames=e}}var Sc,Cc;function Ic(t){if(void 0===t)return pi("GRPC error has no .code"),bi.UNKNOWN;switch(t){case Sc.OK:return bi.OK;case Sc.CANCELLED:return bi.CANCELLED;case Sc.UNKNOWN:return bi.UNKNOWN;case Sc.DEADLINE_EXCEEDED:return bi.DEADLINE_EXCEEDED;case Sc.RESOURCE_EXHAUSTED:return bi.RESOURCE_EXHAUSTED;case Sc.INTERNAL:return bi.INTERNAL;case Sc.UNAVAILABLE:return bi.UNAVAILABLE;case Sc.UNAUTHENTICATED:return bi.UNAUTHENTICATED;case Sc.INVALID_ARGUMENT:return bi.INVALID_ARGUMENT;case Sc.NOT_FOUND:return bi.NOT_FOUND;case Sc.ALREADY_EXISTS:return bi.ALREADY_EXISTS;case Sc.PERMISSION_DENIED:return bi.PERMISSION_DENIED;case Sc.FAILED_PRECONDITION:return bi.FAILED_PRECONDITION;case Sc.ABORTED:return bi.ABORTED;case Sc.OUT_OF_RANGE:return bi.OUT_OF_RANGE;case Sc.UNIMPLEMENTED:return bi.UNIMPLEMENTED;case Sc.DATA_LOSS:return bi.DATA_LOSS;default:return yi()}}(Cc=Sc||(Sc={}))[Cc.OK=0]="OK",Cc[Cc.CANCELLED=1]="CANCELLED",Cc[Cc.UNKNOWN=2]="UNKNOWN",Cc[Cc.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Cc[Cc.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Cc[Cc.NOT_FOUND=5]="NOT_FOUND",Cc[Cc.ALREADY_EXISTS=6]="ALREADY_EXISTS",Cc[Cc.PERMISSION_DENIED=7]="PERMISSION_DENIED",Cc[Cc.UNAUTHENTICATED=16]="UNAUTHENTICATED",Cc[Cc.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Cc[Cc.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Cc[Cc.ABORTED=10]="ABORTED",Cc[Cc.OUT_OF_RANGE=11]="OUT_OF_RANGE",Cc[Cc.UNIMPLEMENTED=12]="UNIMPLEMENTED",Cc[Cc.INTERNAL=13]="INTERNAL",Cc[Cc.UNAVAILABLE=14]="UNAVAILABLE",Cc[Cc.DATA_LOSS=15]="DATA_LOSS";const Dc=new ai([4294967295,4294967295],0);function Ac(t){const e=(new TextEncoder).encode(t),n=new oi;return n.update(e),new Uint8Array(n.digest())}function kc(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new ai([n,r],0),new ai([s,i],0)]}class Nc{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new xc(`Invalid padding: ${e}`);if(n<0)throw new xc(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new xc(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new xc(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=ai.fromNumber(this.Te)}de(t,e,n){let r=t.add(e.multiply(ai.fromNumber(n)));return 1===r.compare(Dc)&&(r=new ai([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Te)return!1;const e=Ac(t),[n,r]=kc(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);if(!this.Ae(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),i=new Nc(s,r,e);return n.forEach((t=>i.insert(t))),i}insert(t){if(0===this.Te)return;const e=Ac(t),[n,r]=kc(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);this.Re(e)}}Re(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class xc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Rc{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,Lc.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Rc(Pi.min(),r,new uo(Li),Ra(),ja())}}class Lc{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Lc(n,e,ja(),ja(),ja())}}class Oc{constructor(t,e,n,r){this.Ve=t,this.removedTargetIds=e,this.key=n,this.me=r}}class Mc{constructor(t,e){this.targetId=t,this.fe=e}}class Pc{constructor(t,e,n=vo.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class Vc{constructor(){this.ge=0,this.pe=Bc(),this.ye=vo.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=ja(),e=ja(),n=ja();return this.pe.forEach(((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:yi()}})),new Lc(this.ye,this.we,t,e,n)}Fe(){this.Se=!1,this.pe=Bc()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,vi(this.ge>=0)}Le(){this.Se=!0,this.we=!0}}class Fc{constructor(t){this.Be=t,this.ke=new Map,this.qe=Ra(),this.Qe=Uc(),this.Ke=new uo(Li)}$e(t){for(const e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(const e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,(e=>{const n=this.ze(e);switch(t.state){case 0:this.je(e)&&n.Ce(t.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(t.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(e);break;case 3:this.je(e)&&(n.Le(),n.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),n.Ce(t.resumeToken));break;default:yi()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach(((t,n)=>{this.je(n)&&e(n)}))}Je(t){const e=t.targetId,n=t.fe.count,r=this.Ye(e);if(r){const s=r.target;if(ya(s))if(0===n){const t=new ji(s.path);this.We(e,t,Ko.newNoDocument(t,Pi.min()))}else vi(1===n);else{const r=this.Ze(e);if(r!==n){const n=this.Xe(t),s=n?this.et(n,t,r):1;if(0!==s){this.He(e);const t=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,t)}}}}}Xe(t){const e=t.fe.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=e;let i,o;try{i=_o(n).toUint8Array()}catch(t){if(t instanceof yo)return gi("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new Nc(i,r,s)}catch(t){return gi(t instanceof xc?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Te?null:o}et(t,e,n){return e.fe.count===n-this.rt(t,e.targetId)?0:2}rt(t,e){const n=this.Be.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const s=this.Be.nt(),i=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;t.mightContain(i)||(this.We(e,n,null),r++)})),r}it(t){const e=new Map;this.ke.forEach(((n,r)=>{const s=this.Ye(r);if(s){if(n.current&&ya(s.target)){const e=new ji(s.target.path);null!==this.qe.get(e)||this.st(r,e)||this.We(r,e,Ko.newNoDocument(e,t))}n.De&&(e.set(r,n.ve()),n.Fe())}}));let n=ja();this.Qe.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Ye(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.qe.forEach(((e,n)=>n.setReadTime(t)));const r=new Rc(t,e,this.Ke,this.qe,n);return this.qe=Ra(),this.Qe=Uc(),this.Ke=new uo(Li),r}Ue(t,e){if(!this.je(t))return;const n=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,n),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,n){if(!this.je(t))return;const r=this.ze(t);this.st(t,e)?r.Me(e,1):r.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),n&&(this.qe=this.qe.insert(e,n))}removeTarget(t){this.ke.delete(t)}Ze(t){const e=this.ze(t).ve();return this.Be.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new Vc,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new po(Li),this.Qe=this.Qe.insert(t,e)),e}je(t){const e=null!==this.Ye(t);return e||fi("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){const e=this.ke.get(t);return e&&e.be?null:this.Be._t(t)}He(t){this.ke.set(t,new Vc),this.Be.getRemoteKeysForTarget(t).forEach((e=>{this.We(t,e,null)}))}st(t,e){return this.Be.getRemoteKeysForTarget(t).has(e)}}function Uc(){return new uo(ji.comparator)}function Bc(){return new uo(ji.comparator)}const jc={asc:"ASCENDING",desc:"DESCENDING"},qc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},$c={and:"AND",or:"OR"};class zc{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Kc(t,e){return t.useProto3Json||io(e)?e:{value:e}}function Gc(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Hc(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Qc(t,e){return Gc(t,e.toTimestamp())}function Wc(t){return vi(!!t),Pi.fromTimestamp(function(t){const e=bo(t);return new Mi(e.seconds,e.nanos)}(t))}function Xc(t,e){return Yc(t,e).canonicalString()}function Yc(t,e){const n=function(t){return new Fi(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function Jc(t){const e=Fi.fromString(t);return vi(mh(e)),e}function Zc(t,e){return Xc(t.databaseId,e.path)}function th(t,e){const n=Jc(e);if(n.get(1)!==t.databaseId.projectId)throw new Ei(bi.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Ei(bi.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ji(rh(n))}function eh(t,e){return Xc(t.databaseId,e)}function nh(t){return new Fi(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function rh(t){return vi(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function sh(t,e,n){return{name:Zc(t,e),fields:n.value.mapValue.fields}}function ih(t,e){return{documents:[eh(t,e.path)]}}function oh(t,e){const n={structuredQuery:{}},r=e.path;let s;null!==e.collectionGroup?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=eh(t,s);const i=function(t){if(0!==t.length)return ph(Zo.create(t,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:dh(t.field),direction:hh(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Kc(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ut:n,parent:s}}function ah(t){let e=function(t){const e=Jc(t);return 4===e.length?Fi.emptyPath():rh(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){vi(1===r);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=function(t){const e=ch(t);return e instanceof Zo&&ea(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new Wo(fh(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,io(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new Go(n,e)}(n.startAt));let h=null;return n.endAt&&(h=function(t){const e=!t.before,n=t.values||[];return new Go(n,e)}(n.endAt)),function(t,e,n,r,s,i,o,a){return new va(t,e,n,r,s,i,o,a)}(e,s,o,i,a,"F",c,h)}function ch(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=fh(t.unaryFilter.field);return Jo.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=fh(t.unaryFilter.field);return Jo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=fh(t.unaryFilter.field);return Jo.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=fh(t.unaryFilter.field);return Jo.create(s,"!=",{nullValue:"NULL_VALUE"});default:return yi()}}(t):void 0!==t.fieldFilter?function(t){return Jo.create(fh(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return yi()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return Zo.create(t.compositeFilter.filters.map((t=>ch(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return yi()}}(t.compositeFilter.op))}(t):yi()}function hh(t){return jc[t]}function uh(t){return qc[t]}function lh(t){return $c[t]}function dh(t){return{fieldPath:t.canonicalString()}}function fh(t){return Bi.fromServerFormat(t.fieldPath)}function ph(t){return t instanceof Jo?function(t){if("=="===t.op){if(Uo(t.value))return{unaryFilter:{field:dh(t.field),op:"IS_NAN"}};if(Fo(t.value))return{unaryFilter:{field:dh(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Uo(t.value))return{unaryFilter:{field:dh(t.field),op:"IS_NOT_NAN"}};if(Fo(t.value))return{unaryFilter:{field:dh(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:dh(t.field),op:uh(t.op),value:t.value}}}(t):t instanceof Zo?function(t){const e=t.getFilters().map((t=>ph(t)));return 1===e.length?e[0]:{compositeFilter:{op:lh(t.op),filters:e}}}(t):yi()}function gh(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function mh(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class yh{constructor(t,e,n,r,s=Pi.min(),i=Pi.min(),o=vo.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new yh(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new yh(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new yh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new yh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class vh{constructor(t){this.ct=t}}function wh(t){const e=ah({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Ta(e,e.limit,"L"):e}class bh{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(Eo(t.integerValue));else if("doubleValue"in t){const n=Eo(t.doubleValue);isNaN(n)?this.Et(e,13):(this.Et(e,15),oo(n)?e.dt(0):e.dt(n))}else if("timestampValue"in t){const n=t.timestampValue;this.Et(e,20),"string"==typeof n?e.At(n):(e.At(`${n.seconds||""}`),e.dt(n.nanos||0))}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(_o(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Et(e,45),e.dt(n.latitude||0),e.dt(n.longitude||0)}else"mapValue"in t?qo(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):yi()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){const n=t.fields||{};this.Et(e,55);for(const t of Object.keys(n))this.Rt(t,e),this.It(n[t],e)}wt(t,e){const n=t.values||[];this.Et(e,50);for(const t of n)this.It(t,e)}gt(t,e){this.Et(e,37),ji.fromName(t).path.forEach((t=>{this.Et(e,60),this.St(t,e)}))}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}}bh.bt=new bh;class Eh{constructor(){this._n=new _h}addToCollectionParentIndex(t,e){return this._n.add(e),Qi.resolve()}getCollectionParents(t,e){return Qi.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return Qi.resolve()}deleteFieldIndex(t,e){return Qi.resolve()}deleteAllFieldIndexes(t){return Qi.resolve()}createTargetIndexes(t,e){return Qi.resolve()}getDocumentsMatchingTarget(t,e){return Qi.resolve(null)}getIndexType(t,e){return Qi.resolve(0)}getFieldIndexes(t,e){return Qi.resolve([])}getNextCollectionGroupToUpdate(t){return Qi.resolve(null)}getMinOffset(t,e){return Qi.resolve($i.min())}getMinOffsetFromCollectionGroup(t,e){return Qi.resolve($i.min())}updateCollectionGroup(t,e,n){return Qi.resolve()}updateIndexEntries(t,e){return Qi.resolve()}}class _h{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new po(Fi.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new po(Fi.comparator)).toArray()}}new Uint8Array(0);class Th{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Th(t,Th.DEFAULT_COLLECTION_PERCENTILE,Th.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Th.DEFAULT_COLLECTION_PERCENTILE=10,Th.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Th.DEFAULT=new Th(41943040,Th.DEFAULT_COLLECTION_PERCENTILE,Th.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Th.DISABLED=new Th(-1,0,0);class Sh{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new Sh(0)}static Ln(){return new Sh(-1)}}class Ch{constructor(){this.changes=new Na((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Ko.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Qi.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Ih{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Dh{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&uc(n.mutation,t,mo.empty(),Mi.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,ja()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=ja()){const r=Pa();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=Oa();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=Pa();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,ja())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let s=Ra();const i=Fa(),o=Fa();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof pc)?s=s.insert(e.key,e):void 0!==o?(i.set(e.key,o.mutation.getFieldMask()),uc(o.mutation,e,o.mutation.getFieldMask(),Mi.now())):i.set(e.key,mo.empty())})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>i.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new Ih(e,null!==(n=i.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=Fa();let r=new uo(((t,e)=>t-e)),s=ja();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const i=e.get(t);if(null===i)return;let o=n.get(t)||mo.empty();o=s.applyToLocalView(i,o),n.set(t,o);const a=(r.get(s.batchId)||ja()).add(t);r=r.insert(s.batchId,a)}))})).next((()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,h=Va();c.forEach((t=>{if(!s.has(t)){const r=cc(e.get(t),n.get(t));null!==r&&h.set(t,r),s=s.add(t)}})),i.push(this.documentOverlayCache.saveOverlays(t,a,h))}return Qi.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return ji.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-s.size):Qi.resolve(Pa());let o=-1,a=s;return i.next((e=>Qi.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?Qi.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,ja()))).next((t=>({batchId:o,changes:Ma(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new ji(e)).next((t=>{let e=Oa();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const s=e.collectionGroup;let i=Oa();return this.indexManager.getCollectionParents(t,s).next((o=>Qi.forEach(o,(o=>{const a=function(t,e){return new va(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(s));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,r)))).next((t=>{s.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,Ko.newInvalidDocument(r)))}));let n=Oa();return t.forEach(((t,r)=>{const i=s.get(t);void 0!==i&&uc(i.mutation,r,mo.empty(),Mi.now()),Da(e,r)&&(n=n.insert(t,r))})),n}))}}class Ah{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return Qi.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:Wc(t.createTime)}}(e)),Qi.resolve()}getNamedQuery(t,e){return Qi.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(t){return{name:t.name,query:wh(t.bundledQuery),readTime:Wc(t.readTime)}}(e)),Qi.resolve()}}class kh{constructor(){this.overlays=new uo(ji.comparator),this.hr=new Map}getOverlay(t,e){return Qi.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Pa();return Qi.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.ht(t,e,r)})),Qi.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.hr.delete(n)),Qi.resolve()}getOverlaysForCollection(t,e,n){const r=Pa(),s=e.length+1,i=new ji(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===s&&t.largestBatchId>n&&r.set(t.getKey(),t)}return Qi.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new uo(((t,e)=>t-e));const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=Pa(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Pa(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return Qi.resolve(o)}ht(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new _c(e,n));let s=this.hr.get(e);void 0===s&&(s=ja(),this.hr.set(e,s)),this.hr.set(e,s.add(n.key))}}class Nh{constructor(){this.Pr=new po(xh.Ir),this.Tr=new po(xh.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){const n=new xh(t,e);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Ar(new xh(t,e))}Rr(t,e){t.forEach((t=>this.removeReference(t,e)))}Vr(t){const e=new ji(new Fi([])),n=new xh(e,t),r=new xh(e,t+1),s=[];return this.Tr.forEachInRange([n,r],(t=>{this.Ar(t),s.push(t.key)})),s}mr(){this.Pr.forEach((t=>this.Ar(t)))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){const e=new ji(new Fi([])),n=new xh(e,t),r=new xh(e,t+1);let s=ja();return this.Tr.forEachInRange([n,r],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new xh(t,0),n=this.Pr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class xh{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return ji.comparator(t.key,e.key)||Li(t.pr,e.pr)}static Er(t,e){return Li(t.pr,e.pr)||ji.comparator(t.key,e.key)}}class Rh{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new po(xh.Ir)}checkEmpty(t){return Qi.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new bc(s,e,n,r);this.mutationQueue.push(i);for(const e of r)this.wr=this.wr.add(new xh(e.key,s)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Qi.resolve(i)}lookupMutationBatch(t,e){return Qi.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.br(n),s=r<0?0:r;return Qi.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Qi.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(t){return Qi.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new xh(e,0),r=new xh(e,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([n,r],(t=>{const e=this.Sr(t.pr);s.push(e)})),Qi.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new po(Li);return e.forEach((t=>{const e=new xh(t,0),r=new xh(t,Number.POSITIVE_INFINITY);this.wr.forEachInRange([e,r],(t=>{n=n.add(t.pr)}))})),Qi.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;ji.isDocumentKey(s)||(s=s.child(""));const i=new xh(new ji(s),0);let o=new po(Li);return this.wr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.pr)),!0)}),i),Qi.resolve(this.Dr(o))}Dr(t){const e=[];return t.forEach((t=>{const n=this.Sr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){vi(0===this.Cr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return Qi.forEach(e.mutations,(r=>{const s=new xh(r.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.wr=n}))}Mn(t){}containsKey(t,e){const n=new xh(e,0),r=this.wr.firstAfterOrEqual(n);return Qi.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,Qi.resolve()}Cr(t,e){return this.br(t)}br(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Sr(t){const e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Lh{constructor(t){this.vr=t,this.docs=new uo(ji.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),s=r?r.size:0,i=this.vr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Qi.resolve(n?n.document.mutableCopy():Ko.newInvalidDocument(e))}getEntries(t,e){let n=Ra();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Ko.newInvalidDocument(t))})),Qi.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let s=Ra();const i=e.path,o=new ji(i.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!i.isPrefixOf(t.path))break;t.path.length>i.length+1||zi(qi(o),n)<=0||(r.has(o.key)||Da(e,o))&&(s=s.insert(o.key,o.mutableCopy()))}return Qi.resolve(s)}getAllFromCollectionGroup(t,e,n,r){yi()}Fr(t,e){return Qi.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Oh(this)}getSize(t){return Qi.resolve(this.size)}}class Oh extends Ch{constructor(t){super(),this.ar=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.ar.addEntry(t,r)):this.ar.removeEntry(n)})),Qi.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}}class Mh{constructor(t){this.persistence=t,this.Mr=new Na((t=>ga(t)),ma),this.lastRemoteSnapshotVersion=Pi.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Nh,this.targetCount=0,this.Lr=Sh.Nn()}forEachTarget(t,e){return this.Mr.forEach(((t,n)=>e(n))),Qi.resolve()}getLastRemoteSnapshotVersion(t){return Qi.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Qi.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Lr.next(),Qi.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Or&&(this.Or=e),Qi.resolve()}qn(t){this.Mr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Lr=new Sh(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,Qi.resolve()}updateTargetData(t,e){return this.qn(e),Qi.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,Qi.resolve()}removeTargets(t,e,n){let r=0;const s=[];return this.Mr.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Mr.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),Qi.waitFor(s).next((()=>r))}getTargetCount(t){return Qi.resolve(this.targetCount)}getTargetData(t,e){const n=this.Mr.get(e)||null;return Qi.resolve(n)}addMatchingKeys(t,e,n){return this.Nr.dr(e,n),Qi.resolve()}removeMatchingKeys(t,e,n){this.Nr.Rr(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach((e=>{s.push(r.markPotentiallyOrphaned(t,e))})),Qi.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),Qi.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Nr.gr(e);return Qi.resolve(n)}containsKey(t,e){return Qi.resolve(this.Nr.containsKey(e))}}class Ph{constructor(t,e){this.Br={},this.overlays={},this.kr=new so(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new Mh(this),this.indexManager=new Eh,this.remoteDocumentCache=function(t){return new Lh(t)}((t=>this.referenceDelegate.Kr(t))),this.serializer=new vh(e),this.$r=new Ah(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new kh,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Br[t.toKey()];return n||(n=new Rh(e,this.referenceDelegate),this.Br[t.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,n){fi("MemoryPersistence","Starting transaction:",t);const r=new Vh(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((t=>this.referenceDelegate.Wr(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Gr(t,e){return Qi.or(Object.values(this.Br).map((n=>()=>n.containsKey(t,e))))}}class Vh extends Gi{constructor(t){super(),this.currentSequenceNumber=t}}class Fh{constructor(t){this.persistence=t,this.zr=new Nh,this.jr=null}static Hr(t){return new Fh(t)}get Jr(){if(this.jr)return this.jr;throw yi()}addReference(t,e,n){return this.zr.addReference(n,e),this.Jr.delete(n.toString()),Qi.resolve()}removeReference(t,e,n){return this.zr.removeReference(n,e),this.Jr.add(n.toString()),Qi.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),Qi.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach((t=>this.Jr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Jr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ur(){this.jr=new Set}Wr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Qi.forEach(this.Jr,(n=>{const r=ji.fromPath(n);return this.Yr(t,r).next((t=>{t||e.removeEntry(r,Pi.min())}))})).next((()=>(this.jr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Yr(t,e).next((t=>{t?this.Jr.delete(e.toString()):this.Jr.add(e.toString())}))}Kr(t){return 0}Yr(t,e){return Qi.or([()=>Qi.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}}class Uh{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.qi=n,this.Qi=r}static Ki(t,e){let n=ja(),r=ja();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Uh(t,e.fromCache,n,r)}}class Bh{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class jh{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=!function(){var t;const e=null===(t=h())||void 0===t?void 0:t.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:Xi.v(d())>0?6:4}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,n,r){const s={result:null};return this.ji(t,e).next((t=>{s.result=t})).next((()=>{if(!s.result)return this.Hi(t,e,r,n).next((t=>{s.result=t}))})).next((()=>{if(s.result)return;const n=new Bh;return this.Ji(t,e,n).next((r=>{if(s.result=r,this.Ui)return this.Yi(t,e,n,r.size)}))})).next((()=>s.result))}Yi(t,e,n,r){return n.documentReadCount<this.Wi?(di()<=C.DEBUG&&fi("QueryEngine","SDK will not create cache indexes for query:",Ia(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),Qi.resolve()):(di()<=C.DEBUG&&fi("QueryEngine","Query:",Ia(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(di()<=C.DEBUG&&fi("QueryEngine","The SDK decides to create cache indexes for query:",Ia(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,_a(e))):Qi.resolve())}ji(t,e){if(ba(e))return Qi.resolve(null);let n=_a(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=Ta(e,null,"F"),n=_a(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const s=ja(...r);return this.zi.getDocuments(t,s).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const i=this.Zi(e,r);return this.Xi(e,i,s,n.readTime)?this.ji(t,Ta(e,null,"F")):this.es(t,i,e,n)}))))})))))}Hi(t,e,n,r){return ba(e)||r.isEqual(Pi.min())?Qi.resolve(null):this.zi.getDocuments(t,n).next((s=>{const i=this.Zi(e,s);return this.Xi(e,i,n,r)?Qi.resolve(null):(di()<=C.DEBUG&&fi("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Ia(e)),this.es(t,i,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=Pi.fromTimestamp(1e9===r?new Mi(n+1,0):new Mi(n,r));return new $i(s,ji.empty(),e)}(r,-1)).next((t=>t)))}))}Zi(t,e){let n=new po(Aa(t));return e.forEach(((e,r)=>{Da(t,r)&&(n=n.add(r))})),n}Xi(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ji(t,e,n){return di()<=C.DEBUG&&fi("QueryEngine","Using full collection scan to execute query:",Ia(e)),this.zi.getDocumentsMatchingQuery(t,e,$i.min(),n)}es(t,e,n,r){return this.zi.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class qh{constructor(t,e,n,r){this.persistence=t,this.ts=e,this.serializer=r,this.ns=new uo(Li),this.rs=new Na((t=>ga(t)),ma),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(n)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Dh(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ns)))}}async function $h(t,e){const n=wi(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((s=>(r=s,n._s(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],i=[];let o=ja();for(const t of r){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({us:t,removedBatchIds:s,addedBatchIds:i})))}))}))}function zh(t){const e=wi(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Qr.getLastRemoteSnapshotVersion(t)))}function Kh(t,e){const n=wi(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function Gh(t,e,n){const r=wi(t),s=r.ns.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(t=>r.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!Zi(t))throw t;fi("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.ns=r.ns.remove(e),r.rs.delete(s.target)}function Hh(t,e,n){const r=wi(t);let s=Pi.min(),i=ja();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=wi(t),s=r.rs.get(n);return void 0!==s?Qi.resolve(r.ns.get(s)):r.Qr.getTargetData(e,n)}(r,t,_a(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>r.ts.getDocumentsMatchingQuery(t,e,n?s:Pi.min(),n?i:ja()))).next((t=>(function(t,e,n){let r=t.ss.get(e)||Pi.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.ss.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,hs:i})))))}class Qh{constructor(){this.activeTargetIds=qa}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Wh{constructor(){this.no=new Qh,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,n){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new Qh,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Xh{io(t){}shutdown(){}}class Yh{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){fi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.uo)t(0)}ao(){fi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.uo)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Jh=null;function Zh(){return null===Jh?Jh=268435456+Math.round(2147483648*Math.random()):Jh++,"0x"+Jh.toString(16)}const tu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class eu{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}}const nu="WebChannelConnection";class ru extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=e+"://"+t.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(t,e,n,r,s){const i=Zh(),o=this.bo(t,e.toUriEncodedString());fi("RestConnection",`Sending RPC '${t}' ${i}:`,o,n);const a={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(a,r,s),this.Co(t,o,a,n).then((e=>(fi("RestConnection",`Received RPC '${t}' ${i}: `,e),e)),(e=>{throw gi("RestConnection",`RPC '${t}' ${i} failed with error: `,e,"url: ",o,"request:",n),e}))}vo(t,e,n,r,s,i){return this.So(t,e,n,r,s)}Do(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+ui,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}bo(t,e){const n=tu[t];return`${this.fo}/v1/${e}:${n}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,e,n,r){const s=Zh();return new Promise(((i,o)=>{const a=new ii;a.setWithCredentials(!0),a.listenOnce(ei.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case ti.NO_ERROR:const e=a.getResponseJson();fi(nu,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(e)),i(e);break;case ti.TIMEOUT:fi(nu,`RPC '${t}' ${s} timed out`),o(new Ei(bi.DEADLINE_EXCEEDED,"Request time out"));break;case ti.HTTP_ERROR:const n=a.getStatus();if(fi(nu,`RPC '${t}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(bi).indexOf(e)>=0?e:bi.UNKNOWN}(e.status);o(new Ei(t,e.message))}else o(new Ei(bi.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Ei(bi.UNAVAILABLE,"Connection failed."));break;default:yi()}}finally{fi(nu,`RPC '${t}' ${s} completed.`)}}));const c=JSON.stringify(r);fi(nu,`RPC '${t}' ${s} sending request:`,r),a.send(e,"POST",c,n,15)}))}Fo(t,e,n){const r=Zh(),s=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=Js(),o=Zs(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const h=s.join("");fi(nu,`Creating RPC '${t}' stream ${r}: ${h}`,a);const u=i.createWebChannel(h,a);let l=!1,d=!1;const f=new eu({lo:e=>{d?fi(nu,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(l||(fi(nu,`Opening RPC '${t}' stream ${r} transport.`),u.open(),l=!0),fi(nu,`RPC '${t}' stream ${r} sending:`,e),u.send(e))},ho:()=>u.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(u,si.EventType.OPEN,(()=>{d||fi(nu,`RPC '${t}' stream ${r} transport opened.`)})),p(u,si.EventType.CLOSE,(()=>{d||(d=!0,fi(nu,`RPC '${t}' stream ${r} transport closed`),f.Vo())})),p(u,si.EventType.ERROR,(e=>{d||(d=!0,gi(nu,`RPC '${t}' stream ${r} transport errored:`,e),f.Vo(new Ei(bi.UNAVAILABLE,"The operation could not be completed")))})),p(u,si.EventType.MESSAGE,(e=>{var n;if(!d){const s=e.data[0];vi(!!s);const i=s,o=i.error||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){fi(nu,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=Sc[t];if(void 0!==e)return Ic(e)}(e),s=o.message;void 0===n&&(n=bi.INTERNAL,s="Unknown error status: "+e+" with message "+o.message),d=!0,f.Vo(new Ei(n,s)),u.close()}else fi(nu,`RPC '${t}' stream ${r} received:`,s),f.mo(s)}})),p(o,ni.STAT_EVENT,(e=>{e.stat===ri.PROXY?fi(nu,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===ri.NOPROXY&&fi(nu,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.Ro()}),0),f}}function su(){return"undefined"!=typeof document?document:null}function iu(t){return new zc(t,!0)}class ou{constructor(t,e,n=1e3,r=1.5,s=6e4){this.oi=t,this.timerId=e,this.Mo=n,this.xo=r,this.Oo=s,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();const e=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Bo),r=Math.max(0,e-n);r>0&&fi("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Bo=Date.now(),t()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Lo&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){null!==this.Lo&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}}class au{constructor(t,e,n,r,s,i,o,a){this.oi=t,this.$o=n,this.Uo=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new ou(t,e)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(t){this.n_(),this.stream.send(t)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(t,e){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==t?this.jo.reset():e&&e.code===bi.RESOURCE_EXHAUSTED?(pi(e.toString()),pi("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):e&&e.code===bi.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.To(e)}i_(){}auth(){this.state=1;const t=this.s_(this.Wo),e=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Wo===e&&this.o_(t,n)}),(e=>{t((()=>{const t=new Ei(bi.UNKNOWN,"Fetching auth token failed: "+e.message);return this.__(t)}))}))}o_(t,e){const n=this.s_(this.Wo);this.stream=this.a_(t,e),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((t=>{n((()=>this.__(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(t){return fi("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}s_(t){return e=>{this.oi.enqueueAndForget((()=>this.Wo===t?e():(fi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class cu extends au{constructor(t,e,n,r,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s}a_(t,e){return this.connection.Fo("Listen",t,e)}onMessage(t){this.jo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:yi()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(t,e){return t.useProto3Json?(vi(void 0===e||"string"==typeof e),vo.fromBase64String(e||"")):(vi(void 0===e||e instanceof Uint8Array),vo.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?bi.UNKNOWN:Ic(t.code);return new Ei(e,t.message||"")}(o);n=new Pc(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=th(t,r.document.name),i=Wc(r.document.updateTime),o=r.document.createTime?Wc(r.document.createTime):Pi.min(),a=new $o({mapValue:{fields:r.document.fields}}),c=Ko.newFoundDocument(s,i,o,a),h=r.targetIds||[],u=r.removedTargetIds||[];n=new Oc(h,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=th(t,r.document),i=r.readTime?Wc(r.readTime):Pi.min(),o=Ko.newNoDocument(s,i),a=r.removedTargetIds||[];n=new Oc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=th(t,r.document),i=r.removedTargetIds||[];n=new Oc([],i,s,null)}else{if(!("filter"in e))return yi();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:s}=t,i=new Tc(r,s),o=t.targetId;n=new Mc(o,i)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Pi.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Pi.min():e.readTime?Wc(e.readTime):Pi.min()}(t);return this.listener.u_(e,n)}c_(t){const e={};e.database=nh(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=ya(r)?{documents:ih(t,r)}:{query:oh(t,r).ut},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=Hc(t,e.resumeToken);const r=Kc(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(Pi.min())>0){n.readTime=Gc(t,e.snapshotVersion.toTimestamp());const r=Kc(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return yi()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.t_(e)}l_(t){const e={};e.database=nh(this.serializer),e.removeTarget=t,this.t_(e)}}class hu extends au{constructor(t,e,n,r,s,i){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(t,e){return this.connection.Fo("Write",t,e)}onMessage(t){if(vi(!!t.streamToken),this.lastStreamToken=t.streamToken,this.h_){this.jo.reset();const e=function(t,e){return t&&t.length>0?(vi(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Wc(t.updateTime):Wc(e);return n.isEqual(Pi.min())&&(n=Wc(e)),new sc(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Wc(t.commitTime);return this.listener.T_(n,e)}return vi(!t.writeResults||0===t.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const t={};t.database=nh(this.serializer),this.t_(t)}I_(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof fc)n={update:sh(t,e.key,e.value)};else if(e instanceof vc)n={delete:Zc(t,e.key)};else if(e instanceof pc)n={update:sh(t,e.key,e.data),updateMask:gh(e.fieldMask)};else{if(!(e instanceof wc))return yi();n={verify:Zc(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Xa)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ya)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Za)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ec)return{fieldPath:e.field.canonicalString(),increment:n.Ie};throw yi()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Qc(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:yi()}(t,e.precondition)),n}(this.serializer,t)))};this.t_(e)}}class uu extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new Ei(bi.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,e,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection.So(t,Yc(e,n),r,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===bi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Ei(bi.UNKNOWN,t.toString())}))}vo(t,e,n,r,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.vo(t,Yc(e,n),r,i,o,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===bi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Ei(bi.UNKNOWN,t.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class lu{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(t){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.y_("Offline")))}set(t){this.b_(),this.m_=0,"Online"===t&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(pi(e),this.g_=!1):fi("OnlineStateTracker",e)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class du{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io((t=>{n.enqueueAndForget((async()=>{Eu(this)&&(fi("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=wi(t);e.v_.add(4),await pu(e),e.x_.set("Unknown"),e.v_.delete(4),await fu(e)}(this))}))})),this.x_=new lu(n,r)}}async function fu(t){if(Eu(t))for(const e of t.F_)await e(!0)}async function pu(t){for(const e of t.F_)await e(!1)}function gu(t,e){const n=wi(t);n.C_.has(e.targetId)||(n.C_.set(e.targetId,e),bu(n)?wu(n):Fu(n).Jo()&&yu(n,e))}function mu(t,e){const n=wi(t),r=Fu(n);n.C_.delete(e),r.Jo()&&vu(n,e),0===n.C_.size&&(r.Jo()?r.Xo():Eu(n)&&n.x_.set("Unknown"))}function yu(t,e){if(t.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Pi.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Fu(t).c_(e)}function vu(t,e){t.O_.Oe(e),Fu(t).l_(e)}function wu(t){t.O_=new Fc({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.C_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),Fu(t).start(),t.x_.p_()}function bu(t){return Eu(t)&&!Fu(t).Ho()&&t.C_.size>0}function Eu(t){return 0===wi(t).v_.size}function _u(t){t.O_=void 0}async function Tu(t){t.C_.forEach(((e,n)=>{yu(t,e)}))}async function Su(t,e){_u(t),bu(t)?(t.x_.S_(e),wu(t)):t.x_.set("Unknown")}async function Cu(t,e,n){if(t.x_.set("Online"),e instanceof Pc&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.C_.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.C_.delete(r),t.O_.removeTarget(r))}(t,e)}catch(n){fi("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Iu(t,n)}else if(e instanceof Oc?t.O_.$e(e):e instanceof Mc?t.O_.Je(e):t.O_.Ge(e),!n.isEqual(Pi.min()))try{const e=await zh(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.O_.it(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.C_.get(r);s&&t.C_.set(r,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.C_.get(e);if(!r)return;t.C_.set(e,r.withResumeToken(vo.EMPTY_BYTE_STRING,r.snapshotVersion)),vu(t,e);const s=new yh(r.target,e,n,r.sequenceNumber);yu(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){fi("RemoteStore","Failed to raise snapshot:",e),await Iu(t,e)}}async function Iu(t,e,n){if(!Zi(e))throw e;t.v_.add(1),await pu(t),t.x_.set("Offline"),n||(n=()=>zh(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{fi("RemoteStore","Retrying IndexedDB access"),await n(),t.v_.delete(1),await fu(t)}))}function Du(t,e){return e().catch((n=>Iu(t,n,e)))}async function Au(t){const e=wi(t),n=Uu(e);let r=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;ku(e);)try{const t=await Kh(e.localStore,r);if(null===t){0===e.D_.length&&n.Xo();break}r=t.batchId,Nu(e,t)}catch(t){await Iu(e,t)}xu(e)&&Ru(e)}function ku(t){return Eu(t)&&t.D_.length<10}function Nu(t,e){t.D_.push(e);const n=Uu(t);n.Jo()&&n.P_&&n.I_(e.mutations)}function xu(t){return Eu(t)&&!Uu(t).Ho()&&t.D_.length>0}function Ru(t){Uu(t).start()}async function Lu(t){Uu(t).d_()}async function Ou(t){const e=Uu(t);for(const n of t.D_)e.I_(n.mutations)}async function Mu(t,e,n){const r=t.D_.shift(),s=Ec.from(r,e,n);await Du(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await Au(t)}async function Pu(t,e){e&&Uu(t).P_&&await async function(t,e){if(function(t){return function(t){switch(t){default:return yi();case bi.CANCELLED:case bi.UNKNOWN:case bi.DEADLINE_EXCEEDED:case bi.RESOURCE_EXHAUSTED:case bi.INTERNAL:case bi.UNAVAILABLE:case bi.UNAUTHENTICATED:return!1;case bi.INVALID_ARGUMENT:case bi.NOT_FOUND:case bi.ALREADY_EXISTS:case bi.PERMISSION_DENIED:case bi.FAILED_PRECONDITION:case bi.ABORTED:case bi.OUT_OF_RANGE:case bi.UNIMPLEMENTED:case bi.DATA_LOSS:return!0}}(t)&&t!==bi.ABORTED}(e.code)){const n=t.D_.shift();Uu(t).Zo(),await Du(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Au(t)}}(t,e),xu(t)&&Ru(t)}async function Vu(t,e){const n=wi(t);n.asyncQueue.verifyOperationInProgress(),fi("RemoteStore","RemoteStore received new credentials");const r=Eu(n);n.v_.add(3),await pu(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.v_.delete(3),await fu(n)}function Fu(t){return t.N_||(t.N_=function(t,e,n){const r=wi(t);return r.R_(),new cu(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Po:Tu.bind(null,t),To:Su.bind(null,t),u_:Cu.bind(null,t)}),t.F_.push((async e=>{e?(t.N_.Zo(),bu(t)?wu(t):t.x_.set("Unknown")):(await t.N_.stop(),_u(t))}))),t.N_}function Uu(t){return t.L_||(t.L_=function(t,e,n){const r=wi(t);return r.R_(),new hu(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Po:Lu.bind(null,t),To:Pu.bind(null,t),E_:Ou.bind(null,t),T_:Mu.bind(null,t)}),t.F_.push((async e=>{e?(t.L_.Zo(),await Au(t)):(await t.L_.stop(),t.D_.length>0&&(fi("RemoteStore",`Stopping write stream with ${t.D_.length} pending writes`),t.D_=[]))}))),t.L_}class Bu{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new _i,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new Bu(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ei(bi.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ju(t,e){if(pi("AsyncQueue",`${e}: ${t}`),Zi(t))return new Ei(bi.UNAVAILABLE,`${e}: ${t}`);throw t}class qu{constructor(t){this.comparator=t?(e,n)=>t(e,n)||ji.comparator(e.key,n.key):(t,e)=>ji.comparator(t.key,e.key),this.keyedMap=Oa(),this.sortedSet=new uo(this.comparator)}static emptySet(t){return new qu(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof qu))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new qu;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class $u{constructor(){this.B_=new uo(ji.comparator)}track(t){const e=t.doc.key,n=this.B_.get(e);n?0!==t.type&&3===n.type?this.B_=this.B_.insert(e,t):3===t.type&&1!==n.type?this.B_=this.B_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.B_=this.B_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.B_=this.B_.remove(e):1===t.type&&2===n.type?this.B_=this.B_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):yi():this.B_=this.B_.insert(e,t)}k_(){const t=[];return this.B_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class zu{constructor(t,e,n,r,s,i,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new zu(t,e,qu.emptySet(e),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Sa(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Ku{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some((t=>t.U_()))}}class Gu{constructor(){this.queries=new Na((t=>Ca(t)),Sa),this.onlineState="Unknown",this.W_=new Set}}function Hu(t,e){const n=wi(t);let r=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.Q_)e.z_(t)&&(r=!0);s.q_=t}}r&&Wu(n)}function Qu(t,e,n){const r=wi(t),s=r.queries.get(e);if(s)for(const t of s.Q_)t.onError(n);r.queries.delete(e)}function Wu(t){t.W_.forEach((t=>{t.next()}))}var Xu,Yu;(Yu=Xu||(Xu={})).j_="default",Yu.Cache="cache";class Ju{constructor(t,e,n){this.query=t,this.H_=e,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=n||{}}z_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new zu(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.J_?this.Z_(t)&&(this.H_.next(t),e=!0):this.X_(t,this.onlineState)&&(this.ea(t),e=!0),this.Y_=t,e}onError(t){this.H_.error(t)}G_(t){this.onlineState=t;let e=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,t)&&(this.ea(this.Y_),e=!0),e}X_(t,e){if(!t.fromCache)return!0;if(!this.U_())return!0;const n="Offline"!==e;return(!this.options.ta||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Z_(t){if(t.docChanges.length>0)return!0;const e=this.Y_&&this.Y_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}ea(t){t=zu.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.J_=!0,this.H_.next(t)}U_(){return this.options.source!==Xu.Cache}}class Zu{constructor(t){this.key=t}}class tl{constructor(t){this.key=t}}class el{constructor(t,e){this.query=t,this.ua=e,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=ja(),this.mutatedKeys=ja(),this.ha=Aa(t),this.Pa=new qu(this.ha)}get Ia(){return this.ua}Ta(t,e){const n=e?e.Ea:new $u,r=e?e.Pa:this.Pa;let s=e?e.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const h=r.get(t),u=Da(this.query,e)?e:null,l=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;h&&u?h.data.isEqual(u.data)?l!==d&&(n.track({type:3,doc:u}),f=!0):this.da(h,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.ha(u,a)>0||c&&this.ha(u,c)<0)&&(o=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(a||c)&&(o=!0)),f&&(u?(i=i.add(u),s=d?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const t="F"===this.query.limitType?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{Pa:i,Ea:n,Xi:o,mutatedKeys:s}}da(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const s=this.Pa;this.Pa=t.Pa,this.mutatedKeys=t.mutatedKeys;const i=t.Ea.k_();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return yi()}};return n(t)-n(e)}(t.type,e.type)||this.ha(t.doc,e.doc))),this.Aa(n),r=null!=r&&r;const o=e&&!r?this.Ra():[],a=0===this.la.size&&this.current&&!r?1:0,c=a!==this.ca;return this.ca=a,0!==i.length||c?{snapshot:new zu(this.query,t.Pa,s,i,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),Va:o}:{Va:o}}G_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new $u,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(t){return!this.ua.has(t)&&!!this.Pa.has(t)&&!this.Pa.get(t).hasLocalMutations}Aa(t){t&&(t.addedDocuments.forEach((t=>this.ua=this.ua.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.ua=this.ua.delete(t))),this.current=t.current)}Ra(){if(!this.current)return[];const t=this.la;this.la=ja(),this.Pa.forEach((t=>{this.ma(t.key)&&(this.la=this.la.add(t.key))}));const e=[];return t.forEach((t=>{this.la.has(t)||e.push(new tl(t))})),this.la.forEach((n=>{t.has(n)||e.push(new Zu(n))})),e}fa(t){this.ua=t.hs,this.la=ja();const e=this.Ta(t.documents);return this.applyChanges(e,!0)}ga(){return zu.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,0===this.ca,this.hasCachedResults)}}class nl{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class rl{constructor(t){this.key=t,this.pa=!1}}class sl{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.ya={},this.wa=new Na((t=>Ca(t)),Sa),this.Sa=new Map,this.ba=new Set,this.Da=new uo(ji.comparator),this.Ca=new Map,this.va=new Nh,this.Fa={},this.Ma=new Map,this.xa=Sh.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return!0===this.Oa}}async function il(t,e,n=!0){const r=Cl(t);let s;const i=r.wa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.ga()):s=await al(r,e,n,!0),s}async function ol(t,e){const n=Cl(t);await al(n,e,!0,!1)}async function al(t,e,n,r){const s=await function(t,e){const n=wi(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Qr.getTargetData(t,e).next((s=>s?(r=s,Qi.resolve(r)):n.Qr.allocateTargetId(t).next((s=>(r=new yh(e,s,"TargetPurposeListen",t.currentSequenceNumber),n.Qr.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.ns.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(t.targetId,t),n.rs.set(e,t.targetId)),t}))}(t.localStore,_a(e)),i=s.targetId,o=n?t.sharedClientState.addLocalQueryTarget(i):"not-current";let a;return r&&(a=await async function(t,e,n,r,s){t.Na=(e,n,r)=>async function(t,e,n,r){let s=e.view.Ta(n);s.Xi&&(s=await Hh(t.localStore,e.query,!1).then((({documents:t})=>e.view.Ta(t,s))));const i=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(s,t.isPrimaryClient,i,o);return wl(t,e.targetId,a.Va),a.snapshot}(t,e,n,r);const i=await Hh(t.localStore,e,!0),o=new el(e,i.hs),a=o.Ta(i.documents),c=Lc.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,s),h=o.applyChanges(a,t.isPrimaryClient,c);wl(t,n,h.Va);const u=new nl(e,n,o);return t.wa.set(e,u),t.Sa.has(n)?t.Sa.get(n).push(e):t.Sa.set(n,[e]),h.snapshot}(t,e,i,"current"===o,s.resumeToken)),t.isPrimaryClient&&n&&gu(t.remoteStore,s),a}async function cl(t,e,n){const r=wi(t),s=r.wa.get(e),i=r.Sa.get(s.targetId);if(i.length>1)return r.Sa.set(s.targetId,i.filter((t=>!Sa(t,e)))),void r.wa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Gh(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),n&&mu(r.remoteStore,s.targetId),yl(r,s.targetId)})).catch(Hi)):(yl(r,s.targetId),await Gh(r.localStore,s.targetId,!0))}async function hl(t,e){const n=wi(t),r=n.wa.get(e),s=n.Sa.get(r.targetId);n.isPrimaryClient&&1===s.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),mu(n.remoteStore,r.targetId))}async function ul(t,e){const n=wi(t);try{const t=await function(t,e){const n=wi(t),r=e.snapshotVersion;let s=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.os.newChangeBuffer({trackRemovals:!0});s=n.ns;const o=[];e.targetChanges.forEach(((i,a)=>{const c=s.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(t,i.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(t,i.addedDocuments,a))));let h=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?h=h.withResumeToken(vo.EMPTY_BYTE_STRING,Pi.min()).withLastLimboFreeSnapshotVersion(Pi.min()):i.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(i.resumeToken,r)),s=s.insert(a,h),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,h,i)&&o.push(n.Qr.updateTargetData(t,h))}));let a=Ra(),c=ja();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n){let r=ja(),s=ja();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=Ra();return n.forEach(((n,i)=>{const o=t.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(Pi.min())?(e.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(i),r=r.insert(n,i)):fi("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{cs:r,ls:s}}))}(t,i,e.documentUpdates).next((t=>{a=t.cs,c=t.ls}))),!r.isEqual(Pi.min())){const e=n.Qr.getLastRemoteSnapshotVersion(t).next((e=>n.Qr.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return Qi.waitFor(o).next((()=>i.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.ns=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Ca.get(e);r&&(vi(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.pa=!0:t.modifiedDocuments.size>0?vi(r.pa):t.removedDocuments.size>0&&(vi(r.pa),r.pa=!1))})),await _l(n,t,e)}catch(t){await Hi(t)}}function ll(t,e,n){const r=wi(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.wa.forEach(((n,r)=>{const s=r.view.G_(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=wi(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.Q_)t.G_(e)&&(r=!0)})),r&&Wu(n)}(r.eventManager,e),t.length&&r.ya.u_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function dl(t,e,n){const r=wi(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Ca.get(e),i=s&&s.key;if(i){let t=new uo(ji.comparator);t=t.insert(i,Ko.newNoDocument(i,Pi.min()));const n=ja().add(i),s=new Rc(Pi.min(),new Map,new uo(Li),t,n);await ul(r,s),r.Da=r.Da.remove(i),r.Ca.delete(e),El(r)}else await Gh(r.localStore,e,!1).then((()=>yl(r,e,n))).catch(Hi)}async function fl(t,e){const n=wi(t),r=e.batch.batchId;try{const t=await function(t,e){const n=wi(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),s=n.os.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const s=n.batch,i=s.keys();let o=Qi.resolve();return i.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const i=n.docVersions.get(t);vi(null!==i),e.version.compareTo(i)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,s)))}(n,t,e,s).next((()=>s.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=ja();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);ml(n,r,null),gl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await _l(n,t)}catch(t){await Hi(t)}}async function pl(t,e,n){const r=wi(t);try{const t=await function(t,e){const n=wi(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(vi(null!==e),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);ml(r,e,n),gl(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await _l(r,t)}catch(n){await Hi(n)}}function gl(t,e){(t.Ma.get(e)||[]).forEach((t=>{t.resolve()})),t.Ma.delete(e)}function ml(t,e,n){const r=wi(t);let s=r.Fa[r.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),r.Fa[r.currentUser.toKey()]=s}}function yl(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Sa.get(e))t.wa.delete(r),n&&t.ya.La(r,n);t.Sa.delete(e),t.isPrimaryClient&&t.va.Vr(e).forEach((e=>{t.va.containsKey(e)||vl(t,e)}))}function vl(t,e){t.ba.delete(e.path.canonicalString());const n=t.Da.get(e);null!==n&&(mu(t.remoteStore,n),t.Da=t.Da.remove(e),t.Ca.delete(n),El(t))}function wl(t,e,n){for(const r of n)r instanceof Zu?(t.va.addReference(r.key,e),bl(t,r)):r instanceof tl?(fi("SyncEngine","Document no longer in limbo: "+r.key),t.va.removeReference(r.key,e),t.va.containsKey(r.key)||vl(t,r.key)):yi()}function bl(t,e){const n=e.key,r=n.path.canonicalString();t.Da.get(n)||t.ba.has(r)||(fi("SyncEngine","New document in limbo: "+n),t.ba.add(r),El(t))}function El(t){for(;t.ba.size>0&&t.Da.size<t.maxConcurrentLimboResolutions;){const e=t.ba.values().next().value;t.ba.delete(e);const n=new ji(Fi.fromString(e)),r=t.xa.next();t.Ca.set(r,new rl(n)),t.Da=t.Da.insert(n,r),gu(t.remoteStore,new yh(_a(wa(n.path)),r,"TargetPurposeLimboResolution",so._e))}}async function _l(t,e,n){const r=wi(t),s=[],i=[],o=[];r.wa.isEmpty()||(r.wa.forEach(((t,a)=>{o.push(r.Na(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){s.push(t);const e=Uh.Ki(a.targetId,t);i.push(e)}})))})),await Promise.all(o),r.ya.u_(s),await async function(t,e){const n=wi(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Qi.forEach(e,(e=>Qi.forEach(e.qi,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>Qi.forEach(e.Qi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Zi(t))throw t;fi("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.ns.get(e),r=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(e,s)}}}(r.localStore,i))}async function Tl(t,e){const n=wi(t);if(!n.currentUser.isEqual(e)){fi("SyncEngine","User change. New user:",e.toKey());const t=await $h(n.localStore,e);n.currentUser=e,function(t,e){t.Ma.forEach((t=>{t.forEach((t=>{t.reject(new Ei(bi.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ma.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await _l(n,t.us)}}function Sl(t,e){const n=wi(t),r=n.Ca.get(e);if(r&&r.pa)return ja().add(r.key);{let t=ja();const r=n.Sa.get(e);if(!r)return t;for(const e of r){const r=n.wa.get(e);t=t.unionWith(r.view.Ia)}return t}}function Cl(t){const e=wi(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=ul.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Sl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=dl.bind(null,e),e.ya.u_=Hu.bind(null,e.eventManager),e.ya.La=Qu.bind(null,e.eventManager),e}function Il(t){const e=wi(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=fl.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=pl.bind(null,e),e}class Dl{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=iu(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,r){return new qh(t,e,n,r)}(this.persistence,new jh,t.initialUser,this.serializer)}createPersistence(t){return new Ph(Fh.Hr,this.serializer)}createSharedClientState(t){return new Wh}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Al{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>ll(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Tl.bind(null,this.syncEngine),await async function(t,e){const n=wi(t);e?(n.v_.delete(2),await fu(n)):e||(n.v_.add(2),await pu(n),n.x_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Gu}createDatastore(t){const e=iu(t.databaseInfo.databaseId),n=function(t){return new ru(t)}(t.databaseInfo);return function(t,e,n,r){return new uu(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,s){return new du(t,e,n,r,s)}(this.localStore,this.datastore,t.asyncQueue,(t=>ll(this.syncEngine,t,0)),Yh.D()?new Yh:new Xh)}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new sl(t,e,n,r,s,i);return o&&(a.Oa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t;await async function(t){const e=wi(t);fi("RemoteStore","RemoteStore shutting down."),e.v_.add(5),await pu(e),e.M_.shutdown(),e.x_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate()}}class kl{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.qa(this.observer.next,t)}error(t){this.observer.error?this.qa(this.observer.error,t):pi("Uncaught Error in snapshot listener:",t.toString())}Qa(){this.muted=!0}qa(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Nl{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=hi.UNAUTHENTICATED,this.clientId=Ri.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{fi("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(fi("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Ei(bi.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new _i;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=ju(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function xl(t,e){t.asyncQueue.verifyOperationInProgress(),fi("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await $h(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function Rl(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){fi("FirestoreClient","Using user provided OfflineComponentProvider");try{await xl(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===bi.FAILED_PRECONDITION||t.code===bi.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;gi("Error using user provided cache. Falling back to memory cache: "+n),await xl(t,new Dl)}}else fi("FirestoreClient","Using default OfflineComponentProvider"),await xl(t,new Dl);return t._offlineComponents}(t);fi("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>Vu(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Vu(e.remoteStore,n))),t._onlineComponents=e}async function Ll(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(fi("FirestoreClient","Using user provided OnlineComponentProvider"),await Rl(t,t._uninitializedComponentsProvider._online)):(fi("FirestoreClient","Using default OnlineComponentProvider"),await Rl(t,new Al))),t._onlineComponents}async function Ol(t){const e=await Ll(t),n=e.eventManager;return n.onListen=il.bind(null,e.syncEngine),n.onUnlisten=cl.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=ol.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=hl.bind(null,e.syncEngine),n}function Ml(t,e,n={}){const r=new _i;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new kl({next:n=>{e.enqueueAndForget((()=>async function(t,e){const n=wi(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const t=i.Q_.indexOf(e);t>=0&&(i.Q_.splice(t,1),0===i.Q_.length?s=e.U_()?0:1:!i.K_()&&e.U_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}(t,o))),n.fromCache&&"server"===r.source?s.reject(new Ei(bi.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new Ju(n,i,{includeMetadataChanges:!0,ta:!0});return async function(t,e){const n=wi(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.K_()&&e.U_()&&(r=2):(i=new Ku,r=e.U_()?0:1);try{switch(r){case 0:i.q_=await n.onListen(s,!0);break;case 1:i.q_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(t){const n=ju(t,`Initialization of query '${Ia(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,i),i.Q_.push(e),e.G_(n.onlineState),i.q_&&e.z_(i.q_)&&Wu(n)}(t,o)}(await Ol(t),t.asyncQueue,e,n,r))),r.promise}function Pl(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Vl=new Map;function Fl(t,e,n){if(!n)throw new Ei(bi.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Ul(t){if(!ji.isDocumentKey(t))throw new Ei(bi.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Bl(t){if(ji.isDocumentKey(t))throw new Ei(bi.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function jl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":yi()}function ql(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ei(bi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=jl(t);throw new Ei(bi.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class $l{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Ei(bi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Ei(bi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new Ei(bi.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Pl(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Ei(bi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Ei(bi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Ei(bi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class zl{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $l({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Ei(bi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Ei(bi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $l(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Si;switch(t.type){case"firstParty":return new Ai(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Ei(bi.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Vl.get(t);e&&(fi("ComponentProvider","Removing Datastore"),Vl.delete(t),e.terminate())}(this),Promise.resolve()}}class Kl{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Kl(this.firestore,t,this._query)}}class Gl{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Hl(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Gl(this.firestore,t,this._key)}}class Hl extends Kl{constructor(t,e,n){super(t,e,wa(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Gl(this.firestore,null,new ji(t))}withConverter(t){return new Hl(this.firestore,t,this._path)}}function Ql(t,e,...n){if(t=w(t),Fl("collection","path",e),t instanceof zl){const r=Fi.fromString(e,...n);return Bl(r),new Hl(t,null,r)}{if(!(t instanceof Gl||t instanceof Hl))throw new Ei(bi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Fi.fromString(e,...n));return Bl(r),new Hl(t.firestore,null,r)}}class Wl{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new ou(this,"async_queue_retry"),this.cu=()=>{const t=su();t&&fi("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};const t=su();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.lu(),this.hu(t)}enterRestrictedMode(t){if(!this.iu){this.iu=!0,this.au=t||!1;const e=su();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.cu)}}enqueue(t){if(this.lu(),this.iu)return new Promise((()=>{}));const e=new _i;return this.hu((()=>this.iu&&this.au?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.ru.push(t),this.Pu())))}async Pu(){if(0!==this.ru.length){try{await this.ru[0](),this.ru.shift(),this.jo.reset()}catch(t){if(!Zi(t))throw t;fi("AsyncQueue","Operation failed with retryable error: "+t)}this.ru.length>0&&this.jo.qo((()=>this.Pu()))}}hu(t){const e=this.nu.then((()=>(this._u=!0,t().catch((t=>{this.ou=t,this._u=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw pi("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this._u=!1,t))))));return this.nu=e,e}enqueueAfterDelay(t,e,n){this.lu(),this.uu.indexOf(t)>-1&&(e=0);const r=Bu.createAndSchedule(this,t,e,n,(t=>this.Iu(t)));return this.su.push(r),r}lu(){this.ou&&yi()}verifyOperationInProgress(){}async Tu(){let t;do{t=this.nu,await t}while(t!==this.nu)}Eu(t){for(const e of this.su)if(e.timerId===t)return!0;return!1}du(t){return this.Tu().then((()=>{this.su.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.su)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Tu()}))}Au(t){this.uu.push(t)}Iu(t){const e=this.su.indexOf(t);this.su.splice(e,1)}}class Xl extends zl{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new Wl,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Jl(this),this._firestoreClient.terminate()}}function Yl(t){return t._firestoreClient||Jl(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Jl(t){var e,n,r;const s=t._freezeSettings(),i=function(t,e,n,r){return new Io(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Pl(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,s);t._firestoreClient=new Nl(t._authCredentials,t._appCheckCredentials,t._queue,i),(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=s.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}class Zl{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Zl(vo.fromBase64String(t))}catch(t){throw new Ei(bi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Zl(vo.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class td{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Ei(bi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Bi(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class ed{constructor(t){this._methodName=t}}class nd{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Ei(bi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Ei(bi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Li(this._lat,t._lat)||Li(this._long,t._long)}}const rd=/^__.*__$/;class sd{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new pc(t,this.data,this.fieldMask,e,this.fieldTransforms):new fc(t,this.data,e,this.fieldTransforms)}}function id(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw yi()}}class od{constructor(t,e,n,r,s,i){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Ru(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}mu(t){return new od(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}fu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.mu({path:n,gu:!1});return r.pu(t),r}yu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.mu({path:n,gu:!1});return r.Ru(),r}wu(t){return this.mu({path:void 0,gu:!0})}Su(t){return yd(t,this.settings.methodName,this.settings.bu||!1,this.path,this.settings.Du)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Ru(){if(this.path)for(let t=0;t<this.path.length;t++)this.pu(this.path.get(t))}pu(t){if(0===t.length)throw this.Su("Document fields must not be empty");if(id(this.Vu)&&rd.test(t))throw this.Su('Document fields cannot begin and end with "__"')}}class ad{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||iu(t)}Cu(t,e,n,r=!1){return new od({Vu:t,methodName:e,Du:n,path:Bi.emptyPath(),gu:!1,bu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function cd(t){const e=t._freezeSettings(),n=iu(t._databaseId);return new ad(t._databaseId,!!e.ignoreUndefinedProperties,n)}function hd(t,e,n,r,s,i={}){const o=t.Cu(i.merge||i.mergeFields?2:0,e,n,s);fd("Data must be an object, but it was:",o,r);const a=ld(r,o);let c,h;if(i.merge)c=new mo(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const r of i.mergeFields){const s=pd(e,r,n);if(!o.contains(s))throw new Ei(bi.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);vd(t,s)||t.push(s)}c=new mo(t),h=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,h=o.fieldTransforms;return new sd(new $o(a),c,h)}function ud(t,e){if(dd(t=w(t)))return fd("Unsupported field value:",e,t),ld(t,e);if(t instanceof ed)return function(t,e){if(!id(e.Vu))throw e.Su(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Su(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.gu&&4!==e.Vu)throw e.Su("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const s of t){let t=ud(s,e.wu(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=w(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Ka(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Mi.fromDate(t);return{timestampValue:Gc(e.serializer,n)}}if(t instanceof Mi){const n=new Mi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Gc(e.serializer,n)}}if(t instanceof nd)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Zl)return{bytesValue:Hc(e.serializer,t._byteString)};if(t instanceof Gl){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Su(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Xc(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Su(`Unsupported field value: ${jl(t)}`)}(t,e)}function ld(t,e){const n={};return ho(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):co(t,((t,r)=>{const s=ud(r,e.fu(t));null!=s&&(n[t]=s)})),{mapValue:{fields:n}}}function dd(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Mi||t instanceof nd||t instanceof Zl||t instanceof Gl||t instanceof ed)}function fd(t,e,n){if(!dd(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=jl(n);throw"an object"===r?e.Su(t+" a custom object"):e.Su(t+" "+r)}}function pd(t,e,n){if((e=w(e))instanceof td)return e._internalPath;if("string"==typeof e)return md(t,e);throw yd("Field path arguments must be of type string or ",t,!1,void 0,n)}const gd=new RegExp("[~\\*/\\[\\]]");function md(t,e,n){if(e.search(gd)>=0)throw yd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new td(...e.split("."))._internalPath}catch(r){throw yd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function yd(t,e,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new Ei(bi.INVALID_ARGUMENT,a+t+c)}function vd(t,e){return t.some((t=>t.isEqual(e)))}class wd{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Gl(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new bd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Ed("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class bd extends wd{data(){return super.data()}}function Ed(t,e){return"string"==typeof e?md(t,e):e instanceof td?e._internalPath:e._delegate._internalPath}class _d{convertValue(t,e="none"){switch(ko(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Eo(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(_o(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw yi()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return co(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new nd(Eo(t.latitude),Eo(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=So(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Co(t));default:return null}}convertTimestamp(t){const e=bo(t);return new Mi(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Fi.fromString(t);vi(mh(n));const r=new Do(n.get(1),n.get(3)),s=new ji(n.popFirst(5));return r.isEqual(e)||pi(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}class Td{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Sd extends wd{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Cd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Ed("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Cd extends Sd{data(t={}){return super.data(t)}}class Id{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Td(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Cd(this._firestore,this._userDataWriter,n.key,n,new Td(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Ei(bi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new Cd(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Td(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new Cd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Td(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,i=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:Dd(e.type),doc:r,oldIndex:s,newIndex:i}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Dd(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return yi()}}class Ad extends _d{constructor(t){super(),this.firestore=t}convertBytes(t){return new Zl(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Gl(this.firestore,null,e)}}function kd(t,e){const n=ql(t.firestore,Xl),r=function(t,e,...n){if(t=w(t),1===arguments.length&&(e=Ri.newId()),Fl("doc","path",e),t instanceof zl){const r=Fi.fromString(e,...n);return Ul(r),new Gl(t,null,new ji(r))}{if(!(t instanceof Gl||t instanceof Hl))throw new Ei(bi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Fi.fromString(e,...n));return Ul(r),new Gl(t.firestore,t instanceof Hl?t.converter:null,new ji(r))}}(t),s=function(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}(t.converter,e);return function(t,e){return function(t,e){const n=new _i;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=Il(t);try{const t=await function(t,e){const n=wi(t),r=Mi.now(),s=e.reduce(((t,e)=>t.add(e.key)),ja());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=Ra(),c=ja();return n.os.getEntries(t,s).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((s=>{i=s;const o=[];for(const t of e){const e=lc(t,i.get(t.key).overlayedDocument);null!=e&&o.push(new pc(t.key,e,zo(e.value.mapValue),ic.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Ma(i)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Fa[t.currentUser.toKey()];r||(r=new uo(Li)),r=r.insert(e,n),t.Fa[t.currentUser.toKey()]=r}(r,t.batchId,n),await _l(r,t.changes),await Au(r.remoteStore)}catch(t){const e=ju(t,"Failed to persist write");n.reject(e)}}(await function(t){return Ll(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(Yl(t),e)}(n,[hd(cd(t.firestore),"addDoc",r._key,s,null!==t.converter,{}).toMutation(r._key,ic.exists(!1))]).then((()=>r))}new WeakMap,function(t,e=!0){ui="10.9.0",Dt(new b("firestore",((t,{instanceIdentifier:n,options:r})=>{const s=t.getProvider("app").getImmediate(),i=new Xl(new Ii(t.getProvider("auth-internal")),new Ni(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Ei(bi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Do(t.options.projectId,e)}(s,n),s);return r=Object.assign({useFetchStreams:e},r),i._setSettings(r),i}),"PUBLIC").setMultipleInstances(!0)),xt(ci,"4.5.0",t),xt(ci,"4.5.0","esm2017")}();var Nd=function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};const xd=function(t,e){const n="string"==typeof t?t:"(default)",r=function(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}("object"==typeof t?t:function(t=_t){const e=St.get(t);if(!e&&t===_t&&u())return Nt();if(!e)throw At.create("no-app",{appName:t});return e}(),"firestore").getImmediate({identifier:n});if(!r._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=h())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]})("firestore");t&&function(t,e,n,r={}){var s;const i=(t=ql(t,zl))._getSettings(),o=`${e}:${n}`;if("firestore.googleapis.com"!==i.host&&i.host!==o&&gi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=hi.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[c(JSON.stringify({alg:"none",type:"JWT"})),c(JSON.stringify(i)),""].join(".")}(r.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new Ei(bi.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new hi(i)}t._authCredentials=new Ci(new Ti(e,n))}}(r,...t)}return r}(Nt({apiKey:"AIzaSyDblKMSaGR3l3VUP8Gcylpskcio8hM7cdQ",authDomain:"vanguard-35d26.firebaseapp.com",projectId:"vanguard-35d26",storageBucket:"vanguard-35d26.appspot.com",messagingSenderId:"187651490470",appId:"1:187651490470:web:f995465153247e0d556a67",measurementId:"G-Q75K0PGBWK"})),Rd=()=>Nd(void 0,void 0,void 0,(function*(){const t=yield function(t){t=ql(t,Kl);const e=ql(t.firestore,Xl),n=Yl(e),r=new Ad(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Ei(bi.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),Ml(n,t._query).then((n=>new Id(e,r,t,n)))}(Ql(xd,"info")),e=[];return t.forEach((t=>{const n=t.data();e.push(Object.assign({id:t.id},n))})),e}));var Ld,Od=n(171);!function(t){t.nombre="nombre",t.color="color",t.letra="letra"}(Ld||(Ld={}));class Md extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get observedAttributes(){return Object.keys({nombre:null,color:null,letra:null})}attributeChangedCallback(t,e,n){this[t]=n}connectedCallback(){this.render()}render(){var t;this.shadowRoot&&(this.shadowRoot.innerHTML=`\n    <h2>${this.title}</h2>\n    <p>Nombre: ${this.nombre}</p>\n    <p>Color: ${this.color}</p>\n    <p>Letra: ${this.letra} </p>\n    `);const e=this.ownerDocument.createElement("style");e.innerHTML=Od.A,null===(t=this.shadowRoot)||void 0===t||t.appendChild(e)}}customElements.define("app-card",Md);const Pd=t=>({action:"changeScreen",payload:t});var Vd,Fd;!function(t){t.text="text"}(Vd||(Vd={}));class Ud extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.onButtonClicked=this.onButtonClicked.bind(this),s(this)}static get observedAttributes(){return Object.keys({text:null})}connectedCallback(){this.mount()}attributeChangedCallback(t,e,n){this[t]=n,this.mount()}mount(){this.render(),this.addListeners()}render(){this.shadowRoot&&(this.shadowRoot.innerHTML=`\n            <button id="postbutton" type="submit">${this.text}</button>\n            `)}addListeners(){var t,e;null===(e=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector("#postbutton"))||void 0===e||e.addEventListener("click",this.onButtonClicked)}onButtonClicked(){r(Pd("POST"))}}customElements.define("post-button",Ud),function(t){t.text="text"}(Fd||(Fd={}));class Bd extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.onButtonClicked=this.onButtonClicked.bind(this),s(this)}static get observedAttributes(){return Object.keys({text:null})}connectedCallback(){this.mount()}attributeChangedCallback(t,e,n){this[t]=n,this.mount()}mount(){this.render(),this.addListeners()}render(){this.shadowRoot&&(this.shadowRoot.innerHTML=`\n            <button id="dashbutton" type="submit">${this.text}</button>\n            `)}addListeners(){var t,e;null===(e=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector("#dashbutton"))||void 0===e||e.addEventListener("click",this.onButtonClicked)}onButtonClicked(){r(Pd("DASHBOARD"))}}customElements.define("dash-button",Bd);class jd extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}render(){return function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))}(this,void 0,void 0,(function*(){var t,e;const n=this.ownerDocument.createElement("post-button");n.setAttribute(Vd.text,"Post"),null===(t=this.shadowRoot)||void 0===t||t.appendChild(n);const r=this.ownerDocument.createElement("dash-button");r.setAttribute(Fd.text,"Dashboard"),null===(e=this.shadowRoot)||void 0===e||e.appendChild(r);const s=document.createElement("section");(yield Rd()).forEach((t=>{var e;const n=document.createElement("app-card");n.setAttribute(Ld.nombre,t.nombre),n.setAttribute(Ld.color,t.color),n.setAttribute(Ld.letra,t.letra),s.appendChild(n),null===(e=this.shadowRoot)||void 0===e||e.appendChild(s)}))}))}}customElements.define("app-dashboard",jd);const qd={nombre:"",color:"",letra:""};class $d extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}render(){return function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))}(this,void 0,void 0,(function*(){var t,e,n,r,s,i,o;const a=this.ownerDocument.createElement("post-button");a.setAttribute(Vd.text,"Post"),null===(t=this.shadowRoot)||void 0===t||t.appendChild(a);const c=this.ownerDocument.createElement("dash-button");c.setAttribute(Fd.text,"Dashboard"),null===(e=this.shadowRoot)||void 0===e||e.appendChild(c);const h=this.ownerDocument.createElement("h1");h.innerText="Crea una publicacion",null===(n=this.shadowRoot)||void 0===n||n.appendChild(h);const u=this.ownerDocument.createElement("input");u.type="text",u.placeholder="Nombre",u.addEventListener("change",this.addNombre),null===(r=this.shadowRoot)||void 0===r||r.appendChild(u);const l=this.ownerDocument.createElement("input");l.type="color",l.addEventListener("change",this.addColor),null===(s=this.shadowRoot)||void 0===s||s.appendChild(l);const d=this.ownerDocument.createElement("input");d.placeholder="Letra",d.addEventListener("change",this.addLetra),null===(i=this.shadowRoot)||void 0===i||i.appendChild(d);const f=this.ownerDocument.createElement("button");f.innerHTML="Guardar publicacion",f.addEventListener("click",this.submitForm),null===(o=this.shadowRoot)||void 0===o||o.appendChild(f)}))}addNombre(t){var e;qd.nombre=null===(e=t.target)||void 0===e?void 0:e.value}addColor(t){var e;qd.color=null===(e=t.target)||void 0===e?void 0:e.value}addLetra(t){var e;qd.letra=null===(e=t.target)||void 0===e?void 0:e.value}submitForm(){(t=>{Nd(void 0,void 0,void 0,(function*(){try{yield kd(Ql(xd,"info"),t)}catch(t){console.error("Error adding documents: ")}}))})(qd),alert("Se ha subido tu post")}}customElements.define("app-post",$d);class zd extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),s(this)}connectedCallback(){this.render()}render(){var e,n;switch(console.log(t.screen),this.shadowRoot&&(this.shadowRoot.innerHTML=" "),t.screen){case"POST":const t=this.ownerDocument.createElement("app-post");null===(e=this.shadowRoot)||void 0===e||e.appendChild(t);break;case"DASHBOARD":const r=this.ownerDocument.createElement("app-dashboard");null===(n=this.shadowRoot)||void 0===n||n.appendChild(r)}}}customElements.define("app-container",zd)})()})();